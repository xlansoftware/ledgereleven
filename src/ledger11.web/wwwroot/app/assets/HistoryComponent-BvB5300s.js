import{r as g,j as e,z as x,a6 as z,f as H,Z as P}from"./index-DClkfX2h.js";import{T as L,R as _,B as T,e as N}from"./generateCategoricalChart-BjyP7sRa.js";import{B as E,C as M,X as A,Y as O}from"./BarChart-BZAD5Pq3.js";const Z={light:"",dark:".dark"},D=g.createContext(null);function R(){const s=g.useContext(D);if(!s)throw new Error("useChart must be used within a <ChartContainer />");return s}const $=g.forwardRef(({id:s,className:t,children:r,config:a,...c},f)=>{const i=g.useId(),l=`chart-${s||i.replace(/:/g,"")}`;return e.jsx(D.Provider,{value:{config:a},children:e.jsxs("div",{"data-chart":l,ref:f,className:x("flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none",t),...c,children:[e.jsx(F,{id:l,config:a}),e.jsx(_,{children:r})]})})});$.displayName="Chart";const F=({id:s,config:t})=>{const r=Object.entries(t).filter(([,a])=>a.theme||a.color);return r.length?e.jsx("style",{dangerouslySetInnerHTML:{__html:Object.entries(Z).map(([a,c])=>`
${c} [data-chart=${s}] {
${r.map(([f,i])=>{var u;const l=((u=i.theme)==null?void 0:u[a])||i.color;return l?`  --color-${f}: ${l};`:null}).join(`
`)}
}
`).join(`
`)}}):null},U=L,B=g.forwardRef(({active:s,payload:t,className:r,indicator:a="dot",hideLabel:c=!1,hideIndicator:f=!1,label:i,labelFormatter:l,labelClassName:u,formatter:o,color:d,nameKey:b,labelKey:k},I)=>{const{config:v}=R(),K=g.useMemo(()=>{var m;if(c||!(t!=null&&t.length))return null;const[n]=t,y=`${k||(n==null?void 0:n.dataKey)||(n==null?void 0:n.name)||"value"}`,j=w(v,n,y),h=!k&&typeof i=="string"?((m=v[i])==null?void 0:m.label)||i:j==null?void 0:j.label;return l?e.jsx("div",{className:x("font-medium",u),children:l(h,t)}):h?e.jsx("div",{className:x("font-medium",u),children:h}):null},[i,l,t,c,u,v,k]);if(!s||!(t!=null&&t.length))return null;const p=t.length===1&&a!=="dot";return e.jsxs("div",{ref:I,className:x("grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl",r),children:[p?null:K,e.jsx("div",{className:"grid gap-1.5",children:t.map((n,y)=>{const j=`${b||n.name||n.dataKey||"value"}`,h=w(v,n,j),m=d||n.payload.fill||n.color;return e.jsx("div",{className:x("flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground",a==="dot"&&"items-center"),children:o&&(n==null?void 0:n.value)!==void 0&&n.name?o(n.value,n.name,n,y,n.payload):e.jsxs(e.Fragment,{children:[h!=null&&h.icon?e.jsx(h.icon,{}):!f&&e.jsx("div",{className:x("shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]",{"h-2.5 w-2.5":a==="dot","w-1":a==="line","w-0 border-[1.5px] border-dashed bg-transparent":a==="dashed","my-0.5":p&&a==="dashed"}),style:{"--color-bg":m,"--color-border":m}}),e.jsxs("div",{className:x("flex flex-1 justify-between leading-none",p?"items-end":"items-center"),children:[e.jsxs("div",{className:"grid gap-1.5",children:[p?K:null,e.jsx("span",{className:"text-muted-foreground",children:(h==null?void 0:h.label)||n.name})]}),n.value&&e.jsx("span",{className:"font-mono font-medium tabular-nums text-foreground",children:n.value.toLocaleString()})]})]})},n.dataKey)})})]})});B.displayName="ChartTooltip";const W=g.forwardRef(({className:s,hideIcon:t=!1,payload:r,verticalAlign:a="bottom",nameKey:c},f)=>{const{config:i}=R();return r!=null&&r.length?e.jsx("div",{ref:f,className:x("flex items-center justify-center gap-4",a==="top"?"pb-3":"pt-3",s),children:r.map(l=>{const u=`${c||l.dataKey||"value"}`,o=w(i,l,u);return e.jsxs("div",{className:x("flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground"),children:[o!=null&&o.icon&&!t?e.jsx(o.icon,{}):e.jsx("div",{className:"h-2 w-2 shrink-0 rounded-[2px]",style:{backgroundColor:l.color}}),o==null?void 0:o.label]},l.value)})}):null});W.displayName="ChartLegend";function w(s,t,r){if(typeof t!="object"||t===null)return;const a="payload"in t&&typeof t.payload=="object"&&t.payload!==null?t.payload:void 0;let c=r;return r in t&&typeof t[r]=="string"?c=t[r]:a&&r in a&&typeof a[r]=="string"&&(c=a[r]),c in s?s[c]:s[r]}function X(s,t="en-US"){return new Date(s).toLocaleDateString(t,{weekday:"short"})}function Y({data:s}){return e.jsx($,{config:{},children:e.jsx(_,{width:"100%",height:300,children:e.jsxs(E,{data:s,className:"pt-5",children:[e.jsx(L,{formatter:(t,r)=>[`${t}`,r]}),e.jsx(M,{vertical:!1}),e.jsx(A,{dataKey:"date",tickLine:!1,tickMargin:10,axisLine:!1,tickFormatter:t=>X(t)}),e.jsx(T,{dataKey:"value",fill:"#8884d8",isAnimationActive:!1,radius:4,children:e.jsx(N,{position:"center",className:"fill-foreground",content:({value:t})=>z(Number(t),2)})})]})})})}const q={desktop:{label:"Desktop",color:"var(--chart-2)"},mobile:{label:"Mobile",color:"var(--chart-2)"},label:{color:"var(--background)"}};function S({data:s}){return e.jsx($,{config:q,children:e.jsx(_,{width:"100%",height:300,children:e.jsxs(E,{accessibilityLayer:!0,data:s,layout:"vertical",margin:{right:16},children:[e.jsx(L,{formatter:(t,r)=>[`${t}`,r]}),e.jsx(M,{horizontal:!1}),e.jsx(O,{dataKey:"date",type:"category",tickLine:!1,tickMargin:10,axisLine:!1,hide:!0}),e.jsx(A,{dataKey:"value",type:"number",hide:!0}),e.jsx(U,{cursor:!1,content:e.jsx(B,{indicator:"line"})}),e.jsxs(T,{dataKey:"value",layout:"vertical",fill:"var(--color-desktop)",isAnimationActive:!1,radius:4,children:[e.jsx(N,{dataKey:"date",position:"insideLeft",offset:8,className:"fill-(--color-label)",fontSize:12}),e.jsx(N,{dataKey:"value",position:"right",offset:8,className:"fill-foreground",fontSize:12})]})]})})})}function C({title:s}){return e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white w-full text-center",children:s})}function Q(){const{categories:s,loadCategories:t}=H(),r=s.reduce((o,d)=>(o[d.name]=d,o),{}),[a,c]=g.useState(null);g.useEffect(()=>{s.length===0&&t().catch(d=>{console.error("Error loading categories:",d)});const o=Intl.DateTimeFormat().resolvedOptions().timeZone;P(`/api/insight/history/${encodeURIComponent(o)}`).then(d=>{d.ok?d.json().then(b=>{c(b)}):console.error("Error fetching insights:",d.statusText)})},[s.length,t]);const{dayly:f,weekly:i,monthly:l}=a??{},u=o=>(o.forEach(d=>{d.value=Math.round(d.value)}),o);return e.jsxs("div",{className:"relative",children:[f&&e.jsxs("div",{className:"m-4",children:[e.jsx(C,{title:"Last 7 days"}),e.jsx(Y,{data:u(f.slice(-7)),title:"Daily",categories:r})]}),i&&e.jsxs("div",{className:"m-4",children:[e.jsx(C,{title:"Last 7 weeks"}),e.jsx(S,{data:u(i.slice(-7).reverse()),title:"Weekly",categories:r})]}),l&&e.jsxs("div",{className:"m-4",children:[e.jsx(C,{title:"Last 12 months"}),e.jsx(S,{data:u(l.slice(-12).reverse()),title:"Monthly",categories:r})]})]})}export{Q as default};
