import{c as v,r as i,ab as U,f as O,u as _,ac as V,ad as W,ae as B,j as e,B as r,Z as N,af as Z,ag as Q,Q as C,ah as G,W as J,t as d,ai as z}from"./index-BbVTBCs9.js";import{C as h,a as u,b as m,c as p,d as x,e as A}from"./card-DlI9su2u.js";import{P as K}from"./PreferredLanguage-Bz_dfxsH.js";import{S as X,c as ee,d as se,e as ae,f as te}from"./select-Bl3MXxy3.js";import"./command-O1eAMpVG.js";/**
 * @license lucide-react v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]],I=v("download",ne);/**
 * @license lucide-react v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]],ce=v("moon",re);/**
 * @license lucide-react v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],le=v("sun",oe);/**
 * @license lucide-react v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]],L=v("upload",ie);function de(){const[t,n]=i.useState(null),{loadSpaces:l}=U(),{loadCategories:s}=O(),{loadTransactions:c}=_();return i.useEffect(()=>{V().then(({name:o})=>{n(o)}).catch(o=>{console.error("Error fetching account info:",o),n(null)})},[]),{name:t,login:async(o,j)=>{await W(o,j),await s(),await l(),await c(!0);const{name:w}=await V();n(w)}}}function he(){const{theme:t,resolvedTheme:n,setTheme:l}=B(),s=()=>{l((t==="default"?n:t)==="dark"?"light":"dark")};return e.jsxs(r,{variant:"outline",size:"icon",onClick:s,children:[(t==="default"?n:t)==="dark"?e.jsx(le,{}):e.jsx(ce,{}),e.jsx("span",{className:"sr-only",children:"Toggle theme"})]})}function xe(){const[t,n]=i.useState(null),[l,s]=i.useState(null);return i.useEffect(()=>{N("/api/version").then(async c=>{if(!c.ok)throw new Error(`HTTP error ${c.status}`);const f=await c.json();n(f)}).catch(c=>{s(c)})},[]),{appVersion:t,error:l}}function ge(){const t=Z(),{setTheme:n}=B(),{name:l}=de(),{current:s,spaces:c,setCurrentSpace:f,loadSpaces:o}=U(),{loadTransactions:j}=_(),{confirm:w}=Q(),[S,b]=i.useState(!1),{appVersion:g}=xe();i.useEffect(()=>{o()},[o]);const y=i.useRef(null),F=async a=>{await f(a),await j(!0),d("Current space changed")},$=()=>{window.location.href="/home/signoutall"},P=()=>{window.location.href="/home/manageaccount"},R=()=>{z("/api/backup/export?format=csv"),d("Your data has been exported to a CSV file.")},H=()=>{z("/api/backup/export?format=excel"),d("Your data has been exported to a Excel file.")},Y=async a=>{var D;const T=(D=a.target.files)==null?void 0:D[0];if(!T)return;b(!0);const E=new FormData;E.append("dataFile",T);try{const k=await N("/api/backup/import?clearExistingData=false",{method:"POST",body:E});if(k.ok)d.success("File imported successfully!");else{const M=await k.text();console.error("Upload failed:",M),d.error(`Upload failed: ${M}`)}await j(!0)}catch(k){console.error("An error occurred while uploading the file:",k),d.error("An unexpected error occurred. Please try again.")}finally{b(!1),a.target.value="",y.current&&(y.current.value="")}},q=async()=>{w({title:"Are you absolutely sure?",description:`This action cannot be undone. This will permanently delete all your purchase records in ${s==null?void 0:s.name}.`,onConfirm:async()=>{await N("/api/transaction/clear",{method:"POST"}),await o(),await j(!0),d("All your purchase records have been deleted.")}})};return e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Settings"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(h,{children:[e.jsxs(u,{children:[e.jsx(m,{children:"Current Space"}),e.jsx(p,{children:"Spaces let you separate purchases by context—like home, work, or family — and you can collaborate with others by sharing access."})]}),e.jsxs(x,{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{htmlFor:"space-select",children:"Current Space:"}),e.jsxs(X,{value:(s==null?void 0:s.id)??"",onValueChange:a=>F(a),children:[e.jsx(ee,{className:"w-[200px]",id:"space-select",children:e.jsx(se,{placeholder:"Select a space"})}),e.jsx(ae,{children:c.map(a=>e.jsx(te,{value:a.id,children:a.name},a.id))})]})]}),e.jsx(r,{variant:"outline",size:"sm",onClick:()=>t("/spaces"),children:"Edit Spaces..."})]})]}),e.jsxs(h,{children:[e.jsxs(u,{children:[e.jsx(m,{children:"Categories"}),e.jsx(p,{children:"Add, remove or edit the categories..."})]}),e.jsx(x,{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:e.jsx(r,{variant:"outline",size:"sm",onClick:()=>t("/categories"),children:"Edit Categories..."})})]}),e.jsxs(h,{children:[e.jsxs(u,{children:[e.jsx(m,{children:"Theme"}),e.jsx(p,{children:"Toggle dark/light mode."})]}),e.jsx(x,{children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx(he,{}),e.jsx(r,{variant:"link",onClick:()=>n("default"),children:"Use auto"})]})})]}),e.jsxs(h,{children:[e.jsxs(u,{children:[e.jsx(m,{children:"Language"}),e.jsx(p,{children:"Select the language the receipts are in. It is used to recognize text from pictures of receipts."})]}),e.jsx(x,{children:e.jsx(K,{})})]}),e.jsxs(h,{children:[e.jsxs(u,{children:[e.jsx(m,{children:"Account"}),e.jsx(p,{children:l?`${l}, you are logged in.`:"You are not logged in."})]}),e.jsx(x,{}),e.jsxs(A,{children:[e.jsx(r,{onClick:$,children:"Log out"}),e.jsx(r,{className:"ml-5",onClick:P,children:"Manage"})]})]}),e.jsxs(h,{children:[e.jsxs(u,{children:[e.jsx(m,{children:"Data Management"}),e.jsx(p,{children:"Backup, restore, or clear your purchase data."})]}),e.jsx(x,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(C,{className:"text-base",children:"Backup Data"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Download your purchase records as a CSV or Excel file"})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs(r,{variant:"outline",size:"sm",onClick:R,children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Export CSV"]}),e.jsxs(r,{variant:"outline",size:"sm",onClick:H,children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Export Excel"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(C,{className:"text-base",children:"Restore Data"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Upload a CSV or Excel file to restore your purchase records"})]}),e.jsxs("div",{children:[e.jsx("input",{ref:y,type:"file",accept:".csv,.xlsx",onChange:Y,className:"hidden",id:"csv-upload"}),e.jsx(r,{variant:"outline",size:"sm",onClick:()=>{var a;return(a=y.current)==null?void 0:a.click()},disabled:S,children:S?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"h-4 w-4 mr-2 animate-spin"}),"Importing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Import"]})})]})]}),e.jsxs(r,{variant:"destructive",size:"sm",onClick:q,children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Clear All Data"]})]})}),e.jsx(A,{children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:["You have ",J(s==null?void 0:s.countTransactions,"record","records")," ","stored."]})})]}),g&&e.jsx(h,{children:e.jsxs(x,{className:"pt-6",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Version: ",g.version]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Commit: ",g.commit]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Built: ",g.built]})]})})]})]})}export{ge as default};
