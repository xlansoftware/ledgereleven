import{a3 as b,j as e,a6 as j,f as Y,r as N,Z as K,V as P}from"./index-CNChYK45.js";import{R as $,P as V,T as Z,a as T,C,L as z}from"./PieChart-NW-HPFJj.js";const F=({data:o,altData:i,title:x,categories:r,children:m})=>{const a=Object.entries(o).map(([t,l])=>{var d,h;return{name:t,value:l,color:((d=r[t])==null?void 0:d.color)||"#8884d8",icon:b((h=r[t])==null?void 0:h.icon)}}),c=i&&Object.entries(i).map(([t,l])=>{var d,h;return{name:t,value:l,color:((d=r[t])==null?void 0:d.color)||"#8884d8",icon:b((h=r[t])==null?void 0:h.icon)}}),u=a.reduce((t,l)=>t+l.value,0),s=c?c.reduce((t,l)=>t+l.value,0):0,{startAngle:n,endAngle:f,altStartAngle:I,altEndAngle:E}=U(u,s),R=s==0?60:70,g=60,k=20,y={today:"Today",yesterday:"Yesterday",thisWeek:"This Week",lastWeek:"Last Week",thisMonth:"This Month",lastMonth:"Last Month",thisYear:"This Year",lastYear:"Last Year",total:"All Time"},D=({viewBox:t})=>e.jsxs("text",{x:t.cx,y:t.cy,textAnchor:"middle",dominantBaseline:"middle",children:[e.jsx("tspan",{x:t.cx,y:(t.cy||0)-12,className:"fill-foreground text-3xl font-bold",children:j(u,0)}),e.jsxs("tspan",{x:t.cx,y:(t.cy||0)+12,className:"fill-muted-foreground text-l font-bold",children:["(",j(s,0),")"]}),e.jsx("tspan",{x:t.cx,y:(t.cy||0)+36,className:"fill-muted-foreground",children:y[x]})]}),L=({viewBox:t})=>e.jsxs("text",{x:t.cx,y:t.cy,textAnchor:"middle",dominantBaseline:"middle",children:[e.jsx("tspan",{x:t.cx,y:t.cy,className:"fill-foreground text-3xl font-bold",children:j(u,0)}),e.jsx("tspan",{x:t.cx,y:(t.cy||0)+24,className:"fill-muted-foreground",children:y[x]})]}),p=({cx:t,cy:l,midAngle:d,outerRadius:h,icon:M})=>{const A=Math.PI/180,O=t+(h+20)*Math.cos(-d*A),S=l+(h+20)*Math.sin(-d*A),W=M;return e.jsx(W,{x:O-10,y:S-10,width:"20",height:"20"})};return e.jsx("div",{children:a.length===0?e.jsx("p",{className:"text-muted-foreground text-center",children:"Â "}):e.jsxs("div",{className:"relative h-64 w-full flex flex-row ",children:[e.jsx($,{width:"100%",height:"100%",children:e.jsxs(V,{margin:{top:0,right:0,left:0,bottom:0},children:[e.jsx(Z,{formatter:(t,l)=>[`${t}`,l]}),c&&e.jsx(T,{isAnimationActive:!1,label:p,data:c,dataKey:"value",nameKey:"name",startAngle:I,endAngle:E,outerRadius:g+k,innerRadius:g,paddingAngle:5,children:c.map((t,l)=>e.jsx(C,{fill:t.color},`cell-${l}`))}),e.jsxs(T,{isAnimationActive:!1,label:p,labelLine:!1,data:a,dataKey:"value",nameKey:"name",startAngle:n,endAngle:f,cx:"50%",cy:"50%",innerRadius:R,paddingAngle:5,fill:"#8884d8",children:[a.map((t,l)=>e.jsx(C,{fill:t.color},`cell-${l}`)),e.jsx(z,{content:({viewBox:t})=>{if(t&&"cx"in t&&"cy"in t)return s===0?e.jsx(L,{viewBox:t}):e.jsx(D,{viewBox:t})}})]})]})}),m]})})};function U(o,i){const x=o+i,r=0,m=o/x*360,a=m+5,c=a+i/x*360-10;return{startAngle:r,endAngle:m,altStartAngle:a,altEndAngle:c}}function H(){const{categories:o,loadCategories:i}=Y(),x=o.reduce((s,n)=>(s[n.name]=n,s),{}),[r,m]=N.useState(null);N.useEffect(()=>{o.length===0&&i().catch(n=>{console.error("Error loading categories:",n)});const s=Intl.DateTimeFormat().resolvedOptions().timeZone;K(`/api/insight/${encodeURIComponent(s)}`).then(n=>{n.ok?n.json().then(f=>{m(f)}):console.error("Error fetching insights:",n.statusText)})},[o.length,i]);const{expense:a,income:c}=r??{},u=!a||Object.keys(a).reduce((s,n)=>s+Object.keys(a[n]).length,0)===0;return e.jsxs("div",{className:"relative",children:[u&&e.jsx("div",{className:"flex items-center justify-center pt-16",children:"No expenses."}),Object.entries(a||{}).map(([s,n])=>n&&e.jsx("div",{className:"mb-4",children:e.jsx(F,{data:n,altData:c==null?void 0:c[s],title:s,categories:x})},s)),r===null&&e.jsx("div",{className:"flex items-center justify-center pt-16",children:e.jsx(P,{size:220,thickness:32})})]})}export{H as default};
