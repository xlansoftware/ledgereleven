import{a_ as v,a$ as X,r as E,j as c,B as ft}from"./index-DClkfX2h.js";import{T as ht}from"./textarea-BYlh-LYQ.js";import{C as nt,a as yt,b as mt,d as at}from"./card-DOP232Ve.js";import{i as vt,D as gt,f as xt,E as At,L as U,a as z,C as bt,A as jt,b as B,c as Pt,d as V,h as wt,e as Ot,g as it,u as St,G as Dt,j as H,k as Ct,l as Et,R as J,m as _t,T as Q,n as Z,B as kt}from"./generateCategoricalChart-BjyP7sRa.js";import{P as Lt,a as Tt}from"./PieChart-BtmwHN6U.js";import{X as ot,Y as st,B as Nt,C as It}from"./BarChart-BZAD5Pq3.js";var Kt=["type","layout","connectNulls","ref"],Bt=["key"];function _(t){"@babel/helpers - typeof";return _=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},_(t)}function tt(t,r){if(t==null)return{};var n=Wt(t,r),e,a;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(a=0;a<s.length;a++)e=s[a],!(r.indexOf(e)>=0)&&Object.prototype.propertyIsEnumerable.call(t,e)&&(n[e]=t[e])}return n}function Wt(t,r){if(t==null)return{};var n={};for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e)){if(r.indexOf(e)>=0)continue;n[e]=t[e]}return n}function W(){return W=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}return t},W.apply(this,arguments)}function et(t,r){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(t);r&&(e=e.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,e)}return n}function x(t){for(var r=1;r<arguments.length;r++){var n=arguments[r]!=null?arguments[r]:{};r%2?et(Object(n),!0).forEach(function(e){b(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):et(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function C(t){return zt(t)||$t(t)||Rt(t)||Ft()}function Ft(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Rt(t,r){if(t){if(typeof t=="string")return Y(t,r);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Y(t,r)}}function $t(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function zt(t){if(Array.isArray(t))return Y(t)}function Y(t,r){(r==null||r>t.length)&&(r=t.length);for(var n=0,e=new Array(r);n<r;n++)e[n]=t[n];return e}function Gt(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function rt(t,r){for(var n=0;n<r.length;n++){var e=r[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,ct(e.key),e)}}function Mt(t,r,n){return r&&rt(t.prototype,r),n&&rt(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Ut(t,r,n){return r=G(r),Vt(t,lt()?Reflect.construct(r,n||[],G(t).constructor):r.apply(t,n))}function Vt(t,r){if(r&&(_(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Yt(t)}function Yt(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function lt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(lt=function(){return!!t})()}function G(t){return G=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},G(t)}function qt(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&q(t,r)}function q(t,r){return q=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,a){return e.__proto__=a,e},q(t,r)}function b(t,r,n){return r=ct(r),r in t?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n,t}function ct(t){var r=Xt(t,"string");return _(r)=="symbol"?r:r+""}function Xt(t,r){if(_(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var e=n.call(t,r);if(_(e)!="object")return e;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var F=function(t){function r(){var n;Gt(this,r);for(var e=arguments.length,a=new Array(e),s=0;s<e;s++)a[s]=arguments[s];return n=Ut(this,r,[].concat(a)),b(n,"state",{isAnimationFinished:!0,totalLength:0}),b(n,"generateSimpleStrokeDasharray",function(i,o){return"".concat(o,"px ").concat(i-o,"px")}),b(n,"getStrokeDasharray",function(i,o,l){var d=l.reduce(function(j,w){return j+w});if(!d)return n.generateSimpleStrokeDasharray(o,i);for(var y=Math.floor(i/d),f=i%d,u=o-i,h=[],p=0,m=0;p<l.length;m+=l[p],++p)if(m+l[p]>f){h=[].concat(C(l.slice(0,p)),[f-m]);break}var A=h.length%2===0?[0,u]:[u];return[].concat(C(r.repeat(l,y)),C(h),A).map(function(j){return"".concat(j,"px")}).join(", ")}),b(n,"id",St("recharts-line-")),b(n,"pathRef",function(i){n.mainCurve=i}),b(n,"handleAnimationEnd",function(){n.setState({isAnimationFinished:!0}),n.props.onAnimationEnd&&n.props.onAnimationEnd()}),b(n,"handleAnimationStart",function(){n.setState({isAnimationFinished:!1}),n.props.onAnimationStart&&n.props.onAnimationStart()}),n}return qt(r,t),Mt(r,[{key:"componentDidMount",value:function(){if(this.props.isAnimationActive){var e=this.getTotalLength();this.setState({totalLength:e})}}},{key:"componentDidUpdate",value:function(){if(this.props.isAnimationActive){var e=this.getTotalLength();e!==this.state.totalLength&&this.setState({totalLength:e})}}},{key:"getTotalLength",value:function(){var e=this.mainCurve;try{return e&&e.getTotalLength&&e.getTotalLength()||0}catch{return 0}}},{key:"renderErrorBar",value:function(e,a){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var s=this.props,i=s.points,o=s.xAxis,l=s.yAxis,d=s.layout,y=s.children,f=xt(y,At);if(!f)return null;var u=function(m,A){return{x:m.x,y:m.y,value:m.value,errorVal:it(m.payload,A)}},h={clipPath:e?"url(#clipPath-".concat(a,")"):null};return v.createElement(U,h,f.map(function(p){return v.cloneElement(p,{key:"bar-".concat(p.props.dataKey),data:i,xAxis:o,yAxis:l,layout:d,dataPointFormatter:u})}))}},{key:"renderDots",value:function(e,a,s){var i=this.props.isAnimationActive;if(i&&!this.state.isAnimationFinished)return null;var o=this.props,l=o.dot,d=o.points,y=o.dataKey,f=z(this.props,!1),u=z(l,!0),h=d.map(function(m,A){var j=x(x(x({key:"dot-".concat(A),r:3},f),u),{},{index:A,cx:m.x,cy:m.y,value:m.value,dataKey:y,payload:m.payload,points:d});return r.renderDotItem(l,j)}),p={clipPath:e?"url(#clipPath-".concat(a?"":"dots-").concat(s,")"):null};return v.createElement(U,W({className:"recharts-line-dots",key:"dots"},p),h)}},{key:"renderCurveStatically",value:function(e,a,s,i){var o=this.props,l=o.type,d=o.layout,y=o.connectNulls;o.ref;var f=tt(o,Kt),u=x(x(x({},z(f,!0)),{},{fill:"none",className:"recharts-line-curve",clipPath:a?"url(#clipPath-".concat(s,")"):null,points:e},i),{},{type:l,layout:d,connectNulls:y});return v.createElement(bt,W({},u,{pathRef:this.pathRef}))}},{key:"renderCurveWithAnimation",value:function(e,a){var s=this,i=this.props,o=i.points,l=i.strokeDasharray,d=i.isAnimationActive,y=i.animationBegin,f=i.animationDuration,u=i.animationEasing,h=i.animationId,p=i.animateNewValues,m=i.width,A=i.height,j=this.state,w=j.prevPoints,k=j.totalLength;return v.createElement(jt,{begin:y,duration:f,isActive:d,easing:u,from:{t:0},to:{t:1},key:"line-".concat(h),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(S){var P=S.t;if(w){var L=w.length/o.length,O=o.map(function(g,M){var I=Math.floor(M*L);if(w[I]){var K=w[I],D=B(K.x,g.x),ut=B(K.y,g.y);return x(x({},g),{},{x:D(P),y:ut(P)})}if(p){var pt=B(m*2,g.x),dt=B(A/2,g.y);return x(x({},g),{},{x:pt(P),y:dt(P)})}return x(x({},g),{},{x:g.x,y:g.y})});return s.renderCurveStatically(O,e,a)}var R=B(0,k),T=R(P),N;if(l){var $="".concat(l).split(/[,\s]+/gim).map(function(g){return parseFloat(g)});N=s.getStrokeDasharray(T,k,$)}else N=s.generateSimpleStrokeDasharray(k,T);return s.renderCurveStatically(o,e,a,{strokeDasharray:N})})}},{key:"renderCurve",value:function(e,a){var s=this.props,i=s.points,o=s.isAnimationActive,l=this.state,d=l.prevPoints,y=l.totalLength;return o&&i&&i.length&&(!d&&y>0||!Pt(d,i))?this.renderCurveWithAnimation(e,a):this.renderCurveStatically(i,e,a)}},{key:"render",value:function(){var e,a=this.props,s=a.hide,i=a.dot,o=a.points,l=a.className,d=a.xAxis,y=a.yAxis,f=a.top,u=a.left,h=a.width,p=a.height,m=a.isAnimationActive,A=a.id;if(s||!o||!o.length)return null;var j=this.state.isAnimationFinished,w=o.length===1,k=X("recharts-line",l),S=d&&d.allowDataOverflow,P=y&&y.allowDataOverflow,L=S||P,O=V(A)?this.id:A,R=(e=z(i,!1))!==null&&e!==void 0?e:{r:3,strokeWidth:2},T=R.r,N=T===void 0?3:T,$=R.strokeWidth,g=$===void 0?2:$,M=wt(i)?i:{},I=M.clipDot,K=I===void 0?!0:I,D=N*2+g;return v.createElement(U,{className:k},S||P?v.createElement("defs",null,v.createElement("clipPath",{id:"clipPath-".concat(O)},v.createElement("rect",{x:S?u:u-h/2,y:P?f:f-p/2,width:S?h:h*2,height:P?p:p*2})),!K&&v.createElement("clipPath",{id:"clipPath-dots-".concat(O)},v.createElement("rect",{x:u-D/2,y:f-D/2,width:h+D,height:p+D}))):null,!w&&this.renderCurve(L,O),this.renderErrorBar(L,O),(w||i)&&this.renderDots(L,K,O),(!m||j)&&Ot.renderCallByParent(this.props,o))}}],[{key:"getDerivedStateFromProps",value:function(e,a){return e.animationId!==a.prevAnimationId?{prevAnimationId:e.animationId,curPoints:e.points,prevPoints:a.curPoints}:e.points!==a.curPoints?{curPoints:e.points}:null}},{key:"repeat",value:function(e,a){for(var s=e.length%2!==0?[].concat(C(e),[0]):e,i=[],o=0;o<a;++o)i=[].concat(C(i),C(s));return i}},{key:"renderDotItem",value:function(e,a){var s;if(v.isValidElement(e))s=v.cloneElement(e,a);else if(vt(e))s=e(a);else{var i=a.key,o=tt(a,Bt),l=X("recharts-line-dot",typeof e!="boolean"?e.className:"");s=v.createElement(gt,W({key:i},o,{className:l}))}return s}}])}(E.PureComponent);b(F,"displayName","Line");b(F,"defaultProps",{xAxisId:0,yAxisId:0,connectNulls:!1,activeDot:!0,dot:!0,legendType:"line",stroke:"#3182bd",strokeWidth:1,fill:"#fff",points:[],isAnimationActive:!Dt.isSsr,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",hide:!1,label:!1});b(F,"getComposedData",function(t){var r=t.props,n=t.xAxis,e=t.yAxis,a=t.xAxisTicks,s=t.yAxisTicks,i=t.dataKey,o=t.bandSize,l=t.displayedData,d=t.offset,y=r.layout,f=l.map(function(u,h){var p=it(u,i);return y==="horizontal"?{x:H({axis:n,ticks:a,bandSize:o,entry:u,index:h}),y:V(p)?null:e.scale(p),value:p,payload:u}:{x:V(p)?null:n.scale(p),y:H({axis:e,ticks:s,bandSize:o,entry:u,index:h}),value:p,payload:u}});return x({points:f,layout:y},d)});var Ht=Ct({chartName:"LineChart",GraphicalChild:F,axisComponents:[{axisType:"xAxis",AxisComp:ot},{axisType:"yAxis",AxisComp:st}],formatAxisMap:Et});const Jt=({params:t})=>{const{chartType:r,title:n,data:e,color:a="#8884d8"}=t,s=()=>{switch(r){case"Line":case"Bar":{const{xAxisKey:i,yAxisKey:o}=t,l=Array.isArray(i)?i[0]:i,d=Array.isArray(o)?o:[o],y=r==="Line"?Ht:Nt,f=d.map(u=>r==="Line"?c.jsx(F,{isAnimationActive:!1,type:"monotone",dataKey:u,stroke:a}):c.jsx(kt,{isAnimationActive:!1,dataKey:u,fill:a,radius:4}));return c.jsx(J,{width:"100%",height:300,children:c.jsxs(y,{data:e,children:[t.showCartesianGrid&&c.jsx(It,{strokeDasharray:"3 3"}),c.jsx(ot,{dataKey:l}),t.showYAxis&&c.jsx(st,{dataKey:d[0]}),c.jsx(Q,{formatter:(u,h)=>[`${u}`,h]}),t.showLegend&&c.jsx(Z,{}),f]})})}case"Pie":{const{pieDataKeys:i}=t;return i?c.jsx(J,{width:"100%",height:300,children:c.jsxs(Lt,{children:[c.jsx(Tt,{data:e,dataKey:i.valueKey,nameKey:i.nameKey,outerRadius:100,fill:a,label:!0,children:e.map((o,l)=>c.jsx(_t,{fill:a},`cell-${l}`))}),c.jsx(Q,{}),c.jsx(Z,{})]})}):c.jsx("p",{children:"Pie chart requires nameKey and valueKey"})}default:return c.jsx("p",{children:"Unsupported chart type"})}};return c.jsxs(nt,{className:"rounded-2xl shadow-md p-4",children:[n&&c.jsx(yt,{children:c.jsx(mt,{children:n})}),c.jsx(at,{children:s()})]})};function ae(){const[t,r]=E.useState(null),[n,e]=E.useState(""),[a,s]=E.useState(!1),[i,o]=E.useState(null),[l,d]=E.useState(null),y=async()=>{s(!0),o(null),d(null);try{const f=await fetch("/api/chart/define-widget",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userDescription:n,id:t})});if(!f.ok)throw new Error("Failed to define widget");const u=await f.json();r(u.id);const h=await fetch(`/api/chart/${u.id}`);if(!h.ok)throw new Error("Failed to execute widget");debugger;const p=await h.json(),m={...JSON.parse(p.params),data:p.data};d(m)}catch(f){o(f.message||"Unknown error")}finally{s(!1)}};return c.jsxs("div",{className:"flex flex-col gap-6 max-w-3xl mx-auto p-4",children:[c.jsx("h1",{className:"text-2xl font-bold",children:"Edit Widget"}),c.jsx(ht,{placeholder:"Describe what you want to see...",value:n,onChange:f=>e(f.target.value),className:"min-h-[100px]"}),c.jsx(ft,{onClick:y,disabled:a,children:a?"Loading...":"Generate Preview"}),i&&c.jsx("p",{className:"text-red-500",children:i}),l&&c.jsx(nt,{children:c.jsxs(at,{className:"p-4",children:[c.jsx("h2",{className:"font-semibold mb-2",children:"Chart Preview"}),c.jsx(Jt,{params:l})]})})]})}export{ae as default};
