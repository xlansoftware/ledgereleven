import{a3 as U,r as g,j as e,R,T,U as q,V,W as k,D as I,a as S,b as F,d as E,u as N,Q as h,_ as v,e as $,B as p,t as f,a4 as j,a5 as A,a6 as M,a7 as O,a0 as z,a8 as L,a9 as P,N as Q,aa as _,ab as C}from"./index-B4qhsmr2.js";import{C as H,d as W}from"./card-CbiVwWpR.js";import{T as G}from"./textarea-DfpDjawP.js";function J({value:s,onValueChange:n,options:c,placeholder:o="Select an option",title:r="Select an option"}){var t;const a=U(),[l,u]=g.useState(!1);if(!a)return e.jsxs(R,{value:s,onValueChange:n,children:[e.jsx(T,{children:e.jsx(q,{placeholder:o})}),e.jsx(V,{children:c.map(d=>e.jsx(k,{value:d.value,children:d.label},d.value))})]});const i=(t=c.find(d=>d.value===s))==null?void 0:t.label;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border rounded-md px-3 py-2 text-sm w-full cursor-pointer",onClick:()=>u(!0),children:i||e.jsx("span",{className:"text-muted-foreground",children:o})}),e.jsx(I,{open:l,onOpenChange:u,children:e.jsxs(S,{className:"p-0",children:[e.jsx(F,{children:e.jsx(E,{className:"p-4 pb-2 text-base font-medium",children:r})}),e.jsx("div",{className:"divide-y max-h-[60vh] overflow-y-auto",children:c.map(d=>e.jsx("div",{className:"px-4 py-3 text-sm hover:bg-muted cursor-pointer",onClick:()=>{n(d.value),u(!1)},children:d.label},d.value))})]})})]})}function K({transaction:s,onClose:n}){var u;const{categories:c,updateTransaction:o}=N(),[r,a]=g.useState({value:`${s.value}`,notes:s.notes?`${s.notes}`:"",categoryId:s.categoryId,currency:s.currency,exchangeRate:s.exchangeRate}),l=async()=>{try{await o(s.id,{...s,value:r.value?Number.parseFloat(r.value):void 0,notes:r.notes,categoryId:r.categoryId||void 0,currency:r.currency||void 0,exchangeRate:r.exchangeRate||void 0}),f.success("Done!")}catch(i){console.error("Error updating transaction:",i),f.error("Error updating transaction")}n()};return e.jsx(I,{defaultOpen:!0,onOpenChange:n,children:e.jsxs(S,{children:[e.jsx(F,{children:e.jsx(E,{children:"Edit Transaction"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"edit-total",children:"Value"}),e.jsx(v,{autoFocus:!0,id:"edit-total",type:"number",placeholder:"0.00",value:r.value,onChange:i=>{const t={...r,value:i.target.value};a(t)}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"edit-notes",children:"Notes"}),e.jsx(v,{id:"edit-notes",type:"text",placeholder:"Notes",value:r.notes,onChange:i=>{const t={...r,notes:i.target.value};a(t)}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"edit-category",children:"Category"}),e.jsx(J,{value:(u=r.categoryId)==null?void 0:u.toString(),onValueChange:i=>a({...r,categoryId:Number(i)}),options:c.map(i=>({value:i.id.toString(),label:i.name})),placeholder:"Select a category",title:"Choose Category"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"edit-currency",children:"Currency"}),e.jsx(v,{id:"edit-currency",type:"text",placeholder:"USD",value:r.currency||"",onChange:i=>{const t={...r,currency:i.target.value};a(t)}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"edit-exchangeRate",children:"Exchange Rate"}),e.jsx(v,{id:"edit-exchangeRate",type:"number",placeholder:"1.00",value:r.exchangeRate||"",onChange:i=>{const t={...r,exchangeRate:parseFloat(i.target.value)};a(t)}})]})]}),e.jsxs($,{children:[e.jsx(p,{variant:"outline",onClick:n,children:"Cancel"}),e.jsx(p,{onClick:l,children:"Save Changes"})]})]})})}function X({transaction:s}){const{removeTransaction:n}=N(),[c,o]=g.useState(!1),r=()=>{requestAnimationFrame(()=>o(!0))},a=async()=>{await n(s.id),f.success("Deleted")};return e.jsxs(e.Fragment,{children:[e.jsxs(j,{children:[e.jsx(j.Trigger,{children:e.jsxs(p,{variant:"ghost",size:"icon",children:[e.jsx(A,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Actions"})]})}),e.jsxs(j.Content,{children:[e.jsxs(j.Item,{onClick:r,children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Edit"]}),e.jsx(O,{title:"Delete item",description:"Are you sure you want to delete this item?",onConfirmed:a})]})]}),c&&e.jsx(K,{transaction:s,onClose:()=>o(!1)})]})}function Y({transaction:s,detail:n,onClose:c}){var i;const{categories:o,updateTransaction:r}=N(),[a,l]=g.useState({value:`${n.value}`,quantity:`${n.quantity}`,description:n.description||"",categoryId:n.categoryId}),u=async()=>{var d;const t={...s,transactionDetails:s.transactionDetails.map(m=>m.id===n.id?{...m,value:a.value?Number.parseFloat(a.value):void 0,quantity:a.quantity?Number.parseFloat(a.quantity):void 0,description:a.description||void 0,category:a.categoryId||void 0}:m)};t.value=(d=t.transactionDetails)==null?void 0:d.reduce((m,y)=>m+(y.value||0)*(y.quantity||1),0),await r(s.id,t),f.success("Done!"),c()};return e.jsx(I,{open:!0,onOpenChange:c,children:e.jsxs(S,{children:[e.jsx(F,{children:e.jsx(E,{children:"Edit Detail"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"edit-amount",children:"Value"}),e.jsx(v,{id:"edit-amount",type:"number",value:a.value,onChange:t=>{const d={...a,value:t.target.value};l(d)}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"edit-quantity",children:"Quantity"}),e.jsx(v,{id:"edit-quantity",type:"number",value:a.quantity,onChange:t=>{const d={...a,quantity:t.target.value};l(d)}})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"edit-description",children:"Description"}),e.jsx(G,{id:"edit-description",value:a.description,onChange:t=>l({...a,description:t.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"edit-category",children:"Category"}),e.jsxs(R,{value:(i=a.categoryId)==null?void 0:i.toString(),onValueChange:t=>l({...a,categoryId:Number(t)}),children:[e.jsx(T,{children:e.jsx(q,{placeholder:"Select a category"})}),e.jsx(V,{children:o.map(t=>e.jsx(k,{value:t.id.toString(),children:t.name},t.id))})]})]})]}),e.jsxs($,{children:[e.jsx(p,{variant:"outline",onClick:c,children:"Cancel"}),e.jsx(p,{onClick:u,children:"Save Changes"})]})]})})}function Z({transaction:s,detail:n}){const{updateTransaction:c}=N(),[o,r]=g.useState(!1),a=()=>{requestAnimationFrame(()=>{r(!0)})},l=async()=>{var u,i;s.transactionDetails=(u=s.transactionDetails)==null?void 0:u.filter(t=>t.id!==n.id),s.value=((i=s.transactionDetails)==null?void 0:i.reduce((t,d)=>t+(d.value||0)*(d.quantity||1),0))||0,await c(s.id,s),f.success("Done!")};return e.jsxs(e.Fragment,{children:[e.jsxs(j,{children:[e.jsx(j.Trigger,{children:e.jsxs(p,{variant:"ghost",size:"icon",onClick:u=>u.stopPropagation(),children:[e.jsx(A,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Actions"})]})}),e.jsxs(j.Content,{children:[e.jsxs(j.Item,{onClick:a,children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Edit"]}),e.jsx(O,{title:"Delete item",description:"Are you sure you want to delete this item?",onConfirmed:l})]})]}),o&&e.jsx(Y,{transaction:s,detail:n,onClose:()=>r(!1)})]})}function B(s,n,c){const o=s*(n??1);return C(o,2)}function w(s){return B(s.value||0,s.exchangeRate,s.currency)}function ee(s,n){if(!s.value)return"N/A";const c=s.value*(s.quantity||1);return B(c||0,n.exchangeRate,n.currency)}function se(s,n,c){return!c||!n?null:`${C(s,2)} x ${C(n,4)??1} ${c}`}function te(s){return se(s.value||0,s.exchangeRate,s.currency)}function le({transaction:s,expanded:n}){var m,y;const{categoryById:c}=N(),[o,r]=g.useState(n||!1),a=s.transactionDetails&&s.transactionDetails.length>0,l=c(s.categoryId),u=(l==null?void 0:l.name)||a&&((m=s.transactionDetails)==null?void 0:m.reduce((x,b)=>{const D=c(b.categoryId);return D&&!x.includes(D.name)&&x.push(D.name),x},[]).join(", ")),i=a?`(${z((y=s.transactionDetails)==null?void 0:y.length,"item","items")})`:"",t=s.notes||u||"No category",d=L(l==null?void 0:l.icon);return e.jsx(H,{"data-testid":`Item: ${t}, ${w(s)}`,"aria-label":`Item: ${t}, ${w(s)}`,className:"overflow-hidden border-t border-b border-l-0 border-r-0 rounded-none",children:e.jsxs(W,{className:"p-0",children:[e.jsxs("div",{className:"flex flex-row",children:[e.jsx("div",{className:"p-2 bg-muted flex items-center",style:l!=null&&l.color?{backgroundColor:l.color,color:P(l.color)}:{},children:(l==null?void 0:l.icon)&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx(d,{})})}),e.jsxs("div",{className:"pl-2 pt-1 pb-1 flex-grow flex items-start justify-between overflow-hidden",children:[e.jsx("div",{className:"flex items-start gap-2 cursor-pointer truncate",onClick:()=>a&&r(!o),children:e.jsx("div",{className:"flex flex-row gap-2 items-center",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"font-medium",children:t}),e.jsx(Q,{variant:"secondary",children:i})]}),e.jsxs("div",{className:"flex flex-wrap gap-x-2 text-sm text-muted-foreground overflow-hidden",children:[e.jsx("div",{className:"truncate overflow-hidden text-ellipsis whitespace-nowrap",children:s.user}),e.jsx("div",{className:"truncate overflow-hidden text-ellipsis whitespace-nowrap",children:_(s.date)})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:u})]})})}),e.jsxs("div",{className:"flex flex-col flex-shrink-0 items-end",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"font-bold",children:w(s)})}),e.jsx(X,{transaction:s})]}),e.jsx("div",{className:"pr-2 text-sm text-muted-foreground",children:te(s)})]})]})]}),a&&o&&e.jsx("div",{className:"border-t bg-muted/40",children:s.transactionDetails.map(x=>{var b;return e.jsx("div",{className:"pt-2 pb-2 pl-12 border-b last:border-b-0",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-grow",children:[e.jsx("div",{className:"font-medium",children:x.description||"Unnamed Item"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:((b=c(x.categoryId))==null?void 0:b.name)||"No category"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-bold",children:ee(x,s)}),x.value&&x.quantity&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:[C(x.value)," × ",x.quantity]})]}),e.jsx(Z,{transaction:s,detail:x})]})},x.id)})})]})})}export{le as T};
