import{c as v,r as l,aa as L,u as U,ab as M,ac as q,ad as _,j as e,B as r,Y as N,ae as W,af as Z,O as C,ag as G,V as J,t as d,ah as z}from"./index-C6kYvDVg.js";import{C as h,a as u,b as p,c as j,d as x,e as A}from"./card-BrAYnc_N.js";import{P as K}from"./PreferredLanguage-BqK-BRBO.js";import{S as Q,c as X,d as ee,e as se,f as ae}from"./select-BDR0TDZj.js";import"./command-BlopKffh.js";/**
 * @license lucide-react v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]],B=v("download",te);/**
 * @license lucide-react v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]],re=v("moon",ne);/**
 * @license lucide-react v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],oe=v("sun",ce);/**
 * @license lucide-react v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]],I=v("upload",ie);function le(){const[t,n]=l.useState(null),{loadSpaces:o}=L(),{openBook:s}=U();return l.useEffect(()=>{M().then(({name:c})=>{n(c)}).catch(c=>{console.error("Error fetching account info:",c),n(null)})},[]),{name:t,login:async(c,f)=>{await q(c,f);const m=await o();m&&await s(m.id);const{name:w}=await M();n(w)}}}function de(){const{theme:t,resolvedTheme:n,setTheme:o}=_(),s=()=>{o((t==="default"?n:t)==="dark"?"light":"dark")};return e.jsxs(r,{variant:"outline",size:"icon",onClick:s,children:[(t==="default"?n:t)==="dark"?e.jsx(oe,{}):e.jsx(re,{}),e.jsx("span",{className:"sr-only",children:"Toggle theme"})]})}function he(){const[t,n]=l.useState(null),[o,s]=l.useState(null);return l.useEffect(()=>{N("/api/version").then(async i=>{if(!i.ok)throw new Error(`HTTP error ${i.status}`);const c=await i.json();n(c)}).catch(i=>{s(i)})},[]),{appVersion:t,error:o}}function fe(){const t=W(),{setTheme:n}=_(),{name:o}=le(),{current:s,spaces:i,setCurrentSpace:c,loadSpaces:f}=L(),{openBook:m}=U(),{confirm:w}=Z(),[S,b]=l.useState(!1),{appVersion:g}=he();l.useEffect(()=>{f(!0)},[f]);const y=l.useRef(null),F=async a=>{await c(a),await m(a),d("Current space changed")},$=()=>{window.location.href="/home/signoutall"},P=()=>{window.location.href="/home/manageaccount"},R=()=>{z("/api/backup/export?format=csv"),d("Your data has been exported to a CSV file.")},Y=()=>{z("/api/backup/export?format=excel"),d("Your data has been exported to a Excel file.")},H=async a=>{var D;const T=(D=a.target.files)==null?void 0:D[0];if(!T)return;b(!0);const E=new FormData;E.append("dataFile",T);try{const k=await N("/api/backup/import?clearExistingData=false",{method:"POST",body:E});if(k.ok)d.success("File imported successfully!");else{const V=await k.text();console.error("Upload failed:",V),d.error(`Upload failed: ${V}`)}s!=null&&s.id&&await m(s.id)}catch(k){console.error("An error occurred while uploading the file:",k),d.error("An unexpected error occurred. Please try again.")}finally{b(!1),a.target.value="",y.current&&(y.current.value="")}},O=async()=>{w({title:"Are you absolutely sure?",description:`This action cannot be undone. This will permanently delete all your purchase records in ${s==null?void 0:s.name}.`,onConfirm:async()=>{await N("/api/transaction/clear",{method:"POST"}),await f(!0),s!=null&&s.id&&await m(s.id),d("All your purchase records have been deleted.")}})};return e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Settings"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(h,{children:[e.jsxs(u,{children:[e.jsx(p,{children:"Current Space"}),e.jsx(j,{children:"Spaces let you separate purchases by context—like home, work, or family — and you can collaborate with others by sharing access."})]}),e.jsxs(x,{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{htmlFor:"space-select",children:"Current Space:"}),e.jsxs(Q,{value:(s==null?void 0:s.id)??"",onValueChange:a=>F(a),children:[e.jsx(X,{className:"w-[200px]",id:"space-select",children:e.jsx(ee,{placeholder:"Select a space"})}),e.jsx(se,{children:i.map(a=>e.jsx(ae,{value:a.id,children:a.name},a.id))})]})]}),e.jsx(r,{variant:"outline",size:"sm",onClick:()=>t("/spaces"),children:"Edit Spaces..."})]})]}),e.jsxs(h,{children:[e.jsxs(u,{children:[e.jsx(p,{children:"Categories"}),e.jsx(j,{children:"Add, remove or edit the categories..."})]}),e.jsx(x,{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:e.jsx(r,{variant:"outline",size:"sm",onClick:()=>t("/categories"),children:"Edit Categories..."})})]}),e.jsxs(h,{children:[e.jsxs(u,{children:[e.jsx(p,{children:"Theme"}),e.jsx(j,{children:"Toggle dark/light mode."})]}),e.jsx(x,{children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx(de,{}),e.jsx(r,{variant:"link",onClick:()=>n("default"),children:"Use auto"})]})})]}),e.jsxs(h,{children:[e.jsxs(u,{children:[e.jsx(p,{children:"Language"}),e.jsx(j,{children:"Select the language the receipts are in. It is used to recognize text from pictures of receipts."})]}),e.jsx(x,{children:e.jsx(K,{})})]}),e.jsxs(h,{children:[e.jsxs(u,{children:[e.jsx(p,{children:"Account"}),e.jsx(j,{children:o?`${o}, you are logged in.`:"You are not logged in."})]}),e.jsx(x,{}),e.jsxs(A,{children:[e.jsx(r,{onClick:$,children:"Log out"}),e.jsx(r,{className:"ml-5",onClick:P,children:"Manage"})]})]}),e.jsxs(h,{children:[e.jsxs(u,{children:[e.jsx(p,{children:"Data Management"}),e.jsx(j,{children:"Backup, restore, or clear your purchase data."})]}),e.jsx(x,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(C,{className:"text-base",children:"Backup Data"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Download your purchase records as a CSV or Excel file"})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs(r,{variant:"outline",size:"sm",onClick:R,children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Export CSV"]}),e.jsxs(r,{variant:"outline",size:"sm",onClick:Y,children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Export Excel"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(C,{className:"text-base",children:"Restore Data"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Upload a CSV or Excel file to restore your purchase records"})]}),e.jsxs("div",{children:[e.jsx("input",{ref:y,type:"file",accept:".csv,.xlsx",onChange:H,className:"hidden",id:"csv-upload"}),e.jsx(r,{variant:"outline",size:"sm",onClick:()=>{var a;return(a=y.current)==null?void 0:a.click()},disabled:S,children:S?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"h-4 w-4 mr-2 animate-spin"}),"Importing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Import"]})})]})]}),e.jsxs(r,{variant:"destructive",size:"sm",onClick:O,children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Clear All Data"]})]})}),e.jsx(A,{children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:["You have ",J(s==null?void 0:s.countTransactions,"record","records")," ","stored."]})})]}),g&&e.jsx(h,{children:e.jsxs(x,{className:"pt-6",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Version: ",g.version]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Commit: ",g.commit]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Built: ",g.built]})]})})]})]})}export{fe as default};
