import{c as v,r as l,ag as U,u as L,ah as V,ai as O,aj as _,j as e,B as o,a2 as N,ak as W,al as Q,Q as C,R as Z,T as G,U as J,V as K,W as X,am as ee,a0 as se,t as d,an as M}from"./index-B4qhsmr2.js";import{C as h,a as u,b as p,c as j,d as x,e as z}from"./card-CbiVwWpR.js";import{P as ae}from"./PreferredLanguage-QfpPXQh5.js";import"./command-C7QsYSJL.js";import"./popover-CuWUi8MC.js";/**
 * @license lucide-react v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]],A=v("download",te);/**
 * @license lucide-react v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]],oe=v("moon",ne);/**
 * @license lucide-react v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],ce=v("sun",re);/**
 * @license lucide-react v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]],I=v("upload",ie);function le(){const[t,n]=l.useState(null),{loadSpaces:c}=U(),{openBook:s}=L();return l.useEffect(()=>{V().then(({name:r})=>{n(r)}).catch(r=>{console.error("Error fetching account info:",r),n(null)})},[]),{name:t,login:async(r,f)=>{await O(r,f);const m=await c();m&&await s(m.id);const{name:w}=await V();n(w)}}}function de(){const{theme:t,resolvedTheme:n,setTheme:c}=_(),s=()=>{c((t==="default"?n:t)==="dark"?"light":"dark")};return e.jsxs(o,{variant:"outline",size:"icon",onClick:s,"aria-label":"Toggle theme",children:[(t==="default"?n:t)==="dark"?e.jsx(ce,{}):e.jsx(oe,{}),e.jsx("span",{className:"sr-only",children:"Toggle theme"})]})}function he(){const[t,n]=l.useState(null),[c,s]=l.useState(null);return l.useEffect(()=>{N("/api/version").then(async i=>{if(!i.ok)throw new Error(`HTTP error ${i.status}`);const r=await i.json();n(r)}).catch(i=>{s(i)})},[]),{appVersion:t,error:c}}function fe(){const t=W(),{setTheme:n}=_(),{name:c}=le(),{current:s,spaces:i,setCurrentSpace:r,loadSpaces:f}=U(),{openBook:m}=L(),{confirm:w}=Q(),[b,S]=l.useState(!1),{appVersion:g}=he();l.useEffect(()=>{f(!0)},[f]);const y=l.useRef(null),F=async a=>{await r(a),await m(a),d("Current book changed")},$=()=>{window.location.href="/home/signoutall"},P=()=>{window.location.href="/home/manageaccount"},R=()=>{M("/api/backup/export?format=csv"),d("Your data has been exported to a CSV file.")},H=()=>{M("/api/backup/export?format=excel"),d("Your data has been exported to a Excel file.")},Y=async a=>{var B;const T=(B=a.target.files)==null?void 0:B[0];if(!T)return;S(!0);const E=new FormData;E.append("dataFile",T);try{const k=await N("/api/backup/import?clearExistingData=false",{method:"POST",body:E});if(k.ok)d.success("File imported successfully!");else{const D=await k.text();console.error("Upload failed:",D),d.error(`Upload failed: ${D}`)}s!=null&&s.id&&await m(s.id)}catch(k){console.error("An error occurred while uploading the file:",k),d.error("An unexpected error occurred. Please try again.")}finally{S(!1),a.target.value="",y.current&&(y.current.value="")}},q=async()=>{w({title:"Are you absolutely sure?",description:`This action cannot be undone. This will permanently delete all your purchase records in ${s==null?void 0:s.name}.`,onConfirm:async()=>{await N("/api/transaction/clear",{method:"POST"}),await f(!0),s!=null&&s.id&&await m(s.id),d("All your purchase records have been deleted.")}})};return e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Settings"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(h,{children:[e.jsxs(u,{children:[e.jsx(p,{children:"Current Book"}),e.jsx(j,{children:"Books let you separate purchases by context-like home, work, or family - and you can collaborate with others by sharing access."})]}),e.jsxs(x,{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{htmlFor:"space-select",children:"Current Book:"}),e.jsxs(Z,{value:(s==null?void 0:s.id)??"",onValueChange:a=>F(a),children:[e.jsx(G,{className:"w-[200px]",id:"space-select",children:e.jsx(J,{placeholder:"Select a space"})}),e.jsx(K,{children:i.map(a=>e.jsx(X,{value:a.id,children:a.name},a.id))})]})]}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>t("/spaces"),children:"Edit Books..."})]})]}),e.jsxs(h,{children:[e.jsxs(u,{children:[e.jsx(p,{children:"Categories"}),e.jsx(j,{children:"Add, remove or edit the categories..."})]}),e.jsx(x,{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:e.jsx(o,{variant:"outline",size:"sm",onClick:()=>t("/categories"),children:"Edit Categories..."})})]}),e.jsxs(h,{children:[e.jsxs(u,{children:[e.jsx(p,{children:"Theme"}),e.jsx(j,{children:"Toggle dark/light mode."})]}),e.jsx(x,{children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx(de,{}),e.jsx(o,{variant:"link",onClick:()=>n("default"),children:"Use auto"})]})})]}),e.jsxs(h,{children:[e.jsxs(u,{children:[e.jsx(p,{children:"Language"}),e.jsx(j,{children:"Select the language the receipts are in. It is used to recognize text from pictures of receipts."})]}),e.jsx(x,{children:e.jsx(ae,{})})]}),e.jsxs(h,{children:[e.jsxs(u,{children:[e.jsx(p,{children:"Account"}),e.jsx(j,{children:c?`${c}, you are logged in.`:"You are not logged in."})]}),e.jsx(x,{}),e.jsxs(z,{children:[e.jsx(o,{onClick:$,children:"Log out"}),e.jsx(o,{className:"ml-5",onClick:P,children:"Manage"})]})]}),e.jsxs(h,{children:[e.jsxs(u,{children:[e.jsx(p,{children:"Data Management"}),e.jsx(j,{children:"Backup, restore, or clear your purchase data."})]}),e.jsx(x,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(C,{className:"text-base",children:"Backup Data"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Download your purchase records as a CSV or Excel file"})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs(o,{variant:"outline",size:"sm",onClick:R,children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Export CSV"]}),e.jsxs(o,{variant:"outline",size:"sm",onClick:H,children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Export Excel"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(C,{className:"text-base",children:"Restore Data"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Upload a CSV or Excel file to restore your purchase records"})]}),e.jsxs("div",{children:[e.jsx("input",{ref:y,type:"file",accept:".csv,.xlsx",onChange:Y,className:"hidden",id:"csv-upload"}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>{var a;return(a=y.current)==null?void 0:a.click()},disabled:b,children:b?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"h-4 w-4 mr-2 animate-spin"}),"Importing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Import"]})})]})]}),e.jsxs(o,{variant:"destructive",size:"sm",onClick:q,children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Clear All Data"]})]})}),e.jsx(z,{children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:["You have ",se(s==null?void 0:s.countTransactions,"record","records")," ","stored."]})})]}),g&&e.jsx(h,{children:e.jsxs(x,{className:"pt-6",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Version: ",g.version]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Commit: ",g.commit]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Built: ",g.built]})]})})]})]})}export{fe as default};
