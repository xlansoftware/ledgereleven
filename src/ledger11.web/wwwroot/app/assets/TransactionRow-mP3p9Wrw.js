import{Z as z,r as p,j as e,D as w,a as I,b as S,d as E,u as y,O as j,T as b,e as T,B as v,t as f,_ as h,$ as q,a0 as V,a1 as k,V as L,a2 as P,a3 as _,M as H,a4 as Q,a5 as F}from"./index-C6kYvDVg.js";import{C as U,d as Z}from"./card-BrAYnc_N.js";import{S as $,c as R,d as A,e as M,f as O}from"./select-BDR0TDZj.js";import{T as G}from"./textarea-DlhWO3ue.js";function J({value:s,onValueChange:n,options:l,placeholder:o="Select an option",title:r="Select an option"}){var t;const a=z(),[i,u]=p.useState(!1);if(!a)return e.jsxs($,{value:s,onValueChange:n,children:[e.jsx(R,{children:e.jsx(A,{placeholder:o})}),e.jsx(M,{children:l.map(c=>e.jsx(O,{value:c.value,children:c.label},c.value))})]});const d=(t=l.find(c=>c.value===s))==null?void 0:t.label;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border rounded-md px-3 py-2 text-sm w-full cursor-pointer",onClick:()=>u(!0),children:d||e.jsx("span",{className:"text-muted-foreground",children:o})}),e.jsx(w,{open:i,onOpenChange:u,children:e.jsxs(I,{className:"p-0",children:[e.jsx(S,{children:e.jsx(E,{className:"p-4 pb-2 text-base font-medium",children:r})}),e.jsx("div",{className:"divide-y max-h-[60vh] overflow-y-auto",children:l.map(c=>e.jsx("div",{className:"px-4 py-3 text-sm hover:bg-muted cursor-pointer",onClick:()=>{n(c.value),u(!1)},children:c.label},c.value))})]})})]})}function K({transaction:s,onClose:n}){var u;const{categories:l,updateTransaction:o}=y(),[r,a]=p.useState({value:`${s.value}`,notes:s.notes?`${s.notes}`:"",categoryId:s.categoryId}),i=async()=>{o(s.id,{...s,value:r.value?Number.parseFloat(r.value):void 0,notes:r.notes,categoryId:r.categoryId||void 0}).then(()=>{f.success("Done!")}).catch(d=>{console.error("Error updating transaction:",d),f.error("Error updating transaction")}).finally(()=>{n()})};return e.jsx(w,{defaultOpen:!0,onOpenChange:n,children:e.jsxs(I,{children:[e.jsx(S,{children:e.jsx(E,{children:"Edit Transaction"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"edit-total",children:"Value"}),e.jsx(b,{id:"edit-total",type:"number",placeholder:"0.00",value:r.value,onChange:d=>{const t={...r,value:d.target.value};a(t)}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"edit-notes",children:"Notes"}),e.jsx(b,{id:"edit-notes",type:"text",placeholder:"Notes",value:r.notes,onChange:d=>{const t={...r,notes:d.target.value};a(t)}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"edit-category",children:"Category"}),e.jsx(J,{value:(u=r.categoryId)==null?void 0:u.toString(),onValueChange:d=>a({...r,categoryId:Number(d)}),options:l.map(d=>({value:d.id.toString(),label:d.name})),placeholder:"Select a category",title:"Choose Category"})]})]}),e.jsxs(T,{children:[e.jsx(v,{variant:"outline",onClick:n,children:"Cancel"}),e.jsx(v,{onClick:i,children:"Save Changes"})]})]})})}function W({transaction:s}){const{removeTransaction:n}=y(),[l,o]=p.useState(!1),r=()=>{requestAnimationFrame(()=>o(!0))},a=async()=>{await n(s.id),f.success("Deleted")};return e.jsxs(e.Fragment,{children:[e.jsxs(h,{children:[e.jsx(h.Trigger,{children:e.jsxs(v,{variant:"ghost",size:"icon",children:[e.jsx(q,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Actions"})]})}),e.jsxs(h.Content,{children:[e.jsxs(h.Item,{onClick:r,children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Edit"]}),e.jsx(k,{title:"Delete item",description:"Are you sure you want to delete this item?",onConfirmed:a})]})]}),l&&e.jsx(K,{transaction:s,onClose:()=>o(!1)})]})}function X({transaction:s,detail:n,onClose:l}){var d;const{categories:o,updateTransaction:r}=y(),[a,i]=p.useState({value:`${n.value}`,quantity:`${n.quantity}`,description:n.description||"",categoryId:n.categoryId}),u=async()=>{var c;const t={...s,transactionDetails:s.transactionDetails.map(m=>m.id===n.id?{...m,value:a.value?Number.parseFloat(a.value):void 0,quantity:a.quantity?Number.parseFloat(a.quantity):void 0,description:a.description||void 0,category:a.categoryId||void 0}:m)};t.value=(c=t.transactionDetails)==null?void 0:c.reduce((m,g)=>m+(g.value||0)*(g.quantity||1),0),await r(s.id,t),f.success("Done!"),l()};return e.jsx(w,{open:!0,onOpenChange:l,children:e.jsxs(I,{children:[e.jsx(S,{children:e.jsx(E,{children:"Edit Detail"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"edit-amount",children:"Value"}),e.jsx(b,{id:"edit-amount",type:"number",value:a.value,onChange:t=>{const c={...a,value:t.target.value};i(c)}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"edit-quantity",children:"Quantity"}),e.jsx(b,{id:"edit-quantity",type:"number",value:a.quantity,onChange:t=>{const c={...a,quantity:t.target.value};i(c)}})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"edit-description",children:"Description"}),e.jsx(G,{id:"edit-description",value:a.description,onChange:t=>i({...a,description:t.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"edit-category",children:"Category"}),e.jsxs($,{value:(d=a.categoryId)==null?void 0:d.toString(),onValueChange:t=>i({...a,categoryId:Number(t)}),children:[e.jsx(R,{children:e.jsx(A,{placeholder:"Select a category"})}),e.jsx(M,{children:o.map(t=>e.jsx(O,{value:t.id.toString(),children:t.name},t.id))})]})]})]}),e.jsxs(T,{children:[e.jsx(v,{variant:"outline",onClick:l,children:"Cancel"}),e.jsx(v,{onClick:u,children:"Save Changes"})]})]})})}function Y({transaction:s,detail:n}){const{updateTransaction:l}=y(),[o,r]=p.useState(!1),a=()=>{requestAnimationFrame(()=>{r(!0)})},i=async()=>{var u,d;s.transactionDetails=(u=s.transactionDetails)==null?void 0:u.filter(t=>t.id!==n.id),s.value=((d=s.transactionDetails)==null?void 0:d.reduce((t,c)=>t+(c.value||0)*(c.quantity||1),0))||0,await l(s.id,s),f.success("Done!")};return e.jsxs(e.Fragment,{children:[e.jsxs(h,{children:[e.jsx(h.Trigger,{children:e.jsxs(v,{variant:"ghost",size:"icon",onClick:u=>u.stopPropagation(),children:[e.jsx(q,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Actions"})]})}),e.jsxs(h.Content,{children:[e.jsxs(h.Item,{onClick:a,children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Edit"]}),e.jsx(k,{title:"Delete item",description:"Are you sure you want to delete this item?",onConfirmed:i})]})]}),o&&e.jsx(X,{transaction:s,detail:n,onClose:()=>r(!1)})]})}function B(s,n,l){const o=s*(n??1);return F(o,2)}function C(s){return B(s.value||0,s.exchangeRate,s.currency)}function ee(s,n){if(!s.value)return"N/A";const l=s.value*(s.quantity||1);return B(l||0,n.exchangeRate,n.currency)}function se(s,n,l){return!l||!n?null:`${F(s,2)} x ${n??1} ${l}`}function te(s){return se(s.value||0,s.exchangeRate,s.currency)}function re({transaction:s,expanded:n}){var m,g;const{categoryById:l}=y(),[o,r]=p.useState(n||!1),a=s.transactionDetails&&s.transactionDetails.length>0,i=l(s.categoryId),u=(i==null?void 0:i.name)||a&&((m=s.transactionDetails)==null?void 0:m.reduce((x,N)=>{const D=l(N.categoryId);return D&&!x.includes(D.name)&&x.push(D.name),x},[]).join(", ")),d=a?`(${L((g=s.transactionDetails)==null?void 0:g.length,"item","items")})`:"",t=s.notes||u||"No category",c=P(i==null?void 0:i.icon);return e.jsx(U,{"data-testid":`Item: ${t}, ${C(s)}`,"aria-label":`Item: ${t}, ${C(s)}`,className:"overflow-hidden border-t border-b border-l-0 border-r-0 rounded-none",children:e.jsxs(Z,{className:"p-0",children:[e.jsxs("div",{className:"flex flex-row",children:[e.jsx("div",{className:"p-2 bg-muted flex items-center",style:i!=null&&i.color?{backgroundColor:i.color,color:_(i.color)}:{},children:(i==null?void 0:i.icon)&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx(c,{})})}),e.jsxs("div",{className:"pl-2 pt-1 pb-1 flex-grow flex items-start justify-between overflow-hidden",children:[e.jsx("div",{className:"flex items-start gap-2 cursor-pointer truncate",onClick:()=>a&&r(!o),children:e.jsx("div",{className:"flex flex-row gap-2 items-center",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"font-medium",children:t}),e.jsx(H,{variant:"secondary",children:d})]}),e.jsxs("div",{className:"flex flex-wrap gap-x-2 text-sm text-muted-foreground overflow-hidden",children:[e.jsx("div",{className:"truncate overflow-hidden text-ellipsis whitespace-nowrap",children:s.user}),e.jsx("div",{className:"truncate overflow-hidden text-ellipsis whitespace-nowrap",children:Q(s.date)})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:u})]})})}),e.jsxs("div",{className:"flex flex-col flex-shrink-0 items-end",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"font-bold",children:C(s)})}),e.jsx(W,{transaction:s})]}),e.jsx("div",{className:"pr-2 text-sm text-muted-foreground",children:te(s)})]})]})]}),a&&o&&e.jsx("div",{className:"border-t bg-muted/40",children:s.transactionDetails.map(x=>{var N;return e.jsx("div",{className:"pt-2 pb-2 pl-12 border-b last:border-b-0",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-grow",children:[e.jsx("div",{className:"font-medium",children:x.description||"Unnamed Item"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:((N=l(x.categoryId))==null?void 0:N.name)||"No category"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-bold",children:ee(x,s)}),x.value&&x.quantity&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:[F(x.value)," Ã— ",x.quantity]})]}),e.jsx(Y,{transaction:s,detail:x})]})},x.id)})})]})})}export{re as T};
