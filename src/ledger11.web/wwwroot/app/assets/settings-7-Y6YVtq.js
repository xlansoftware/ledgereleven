import{c as g,r as p,a7 as U,f as H,u as _,a8 as D,a9 as q,aa as F,j as e,B as n,ab as O,ac as W,Q as v,ad as Z,W as Q,t as l,ae as z,Z as I}from"./index-D1oPuFLq.js";import{C as i,a as d,b as h,c as x,d as u,e as M}from"./card-DHSicOam.js";import{P as G}from"./PreferredLanguage-BYpbt9-t.js";import{S as J,c as K,d as X,e as ee,f as se}from"./select-DZJu2cgQ.js";import"./command-B117onxZ.js";/**
 * @license lucide-react v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]],A=g("download",ae);/**
 * @license lucide-react v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]],re=g("moon",te);/**
 * @license lucide-react v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],ce=g("sun",ne);/**
 * @license lucide-react v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]],L=g("upload",le);function oe(){const[t,c]=p.useState(null),{loadSpaces:o}=U(),{loadCategories:s}=H(),{loadTransactions:y}=_();return p.useEffect(()=>{D().then(({name:r})=>{c(r)}).catch(r=>{console.error("Error fetching account info:",r),c(null)})},[]),{name:t,login:async(r,m)=>{await q(r,m),await s(),await o(),await y(!0);const{name:k}=await D();c(k)}}}function ie(){const{theme:t,resolvedTheme:c,setTheme:o}=F(),s=()=>{o((t==="default"?c:t)==="dark"?"light":"dark")};return e.jsxs(n,{variant:"outline",size:"icon",onClick:s,children:[(t==="default"?c:t)==="dark"?e.jsx(ce,{}):e.jsx(re,{}),e.jsx("span",{className:"sr-only",children:"Toggle theme"})]})}function pe(){const t=O(),{setTheme:c}=F(),{name:o}=oe(),{current:s,spaces:y,setCurrentSpace:w,loadSpaces:r}=U(),{loadTransactions:m}=_(),{confirm:k}=W(),[C,S]=p.useState(!1);p.useEffect(()=>{r()},[r]);const j=p.useRef(null),B=async a=>{await w(a),await m(!0),l("Current space changed")},V=()=>{window.location.href="/home/signoutall"},$=()=>{z("/api/backup/export?format=csv"),l("Your data has been exported to a CSV file.")},P=()=>{z("/api/backup/export?format=excel"),l("Your data has been exported to a Excel file.")},R=async a=>{var T;const N=(T=a.target.files)==null?void 0:T[0];if(!N)return;S(!0);const b=new FormData;b.append("dataFile",N);try{const f=await I("/api/backup/import?clearExistingData=false",{method:"POST",body:b});if(f.ok)l.success("File imported successfully!");else{const E=await f.text();console.error("Upload failed:",E),l.error(`Upload failed: ${E}`)}await m(!0)}catch(f){console.error("An error occurred while uploading the file:",f),l.error("An unexpected error occurred. Please try again.")}finally{S(!1),a.target.value="",j.current&&(j.current.value="")}},Y=async()=>{k({title:"Are you absolutely sure?",description:`This action cannot be undone. This will permanently delete all your purchase records in ${s==null?void 0:s.name}.`,onConfirm:async()=>{await I("/api/transaction/clear",{method:"POST"}),await r(),await m(!0),l("All your purchase records have been deleted.")}})};return e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Settings"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(i,{children:[e.jsxs(d,{children:[e.jsx(h,{children:"Current Space"}),e.jsx(x,{children:"Spaces let you separate purchases by context—like home, work, or family — and you can collaborate with others by sharing access."})]}),e.jsxs(u,{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{htmlFor:"space-select",children:"Current Space:"}),e.jsxs(J,{value:(s==null?void 0:s.id)??"",onValueChange:a=>B(a),children:[e.jsx(K,{className:"w-[200px]",id:"space-select",children:e.jsx(X,{placeholder:"Select a space"})}),e.jsx(ee,{children:y.map(a=>e.jsx(se,{value:a.id,children:a.name},a.id))})]})]}),e.jsx(n,{variant:"outline",size:"sm",onClick:()=>t("/spaces"),children:"Edit Spaces..."})]})]}),e.jsxs(i,{children:[e.jsxs(d,{children:[e.jsx(h,{children:"Categories"}),e.jsx(x,{children:"Add, remove or edit the categories..."})]}),e.jsx(u,{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:e.jsx(n,{variant:"outline",size:"sm",onClick:()=>t("/categories"),children:"Edit Categories..."})})]}),e.jsxs(i,{children:[e.jsxs(d,{children:[e.jsx(h,{children:"Theme"}),e.jsx(x,{children:"Toggle dark/light mode."})]}),e.jsx(u,{children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx(ie,{}),e.jsx(n,{variant:"link",onClick:()=>c("default"),children:"Use auto"})]})})]}),e.jsxs(i,{children:[e.jsxs(d,{children:[e.jsx(h,{children:"Language"}),e.jsx(x,{children:"Select the language the receipts are in. It is used to recognize text from pictures of receipts."})]}),e.jsx(u,{children:e.jsx(G,{})})]}),e.jsxs(i,{children:[e.jsxs(d,{children:[e.jsx(h,{children:"Account"}),e.jsx(x,{children:o?`${o}, you are logged in.`:"You are not logged in."})]}),e.jsx(u,{}),e.jsx(M,{children:e.jsx(n,{onClick:V,children:"Log out"})})]}),e.jsxs(i,{children:[e.jsxs(d,{children:[e.jsx(h,{children:"Data Management"}),e.jsx(x,{children:"Backup, restore, or clear your purchase data."})]}),e.jsx(u,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(v,{className:"text-base",children:"Backup Data"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Download your purchase records as a CSV or Excel file"})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs(n,{variant:"outline",size:"sm",onClick:$,children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Export CSV"]}),e.jsxs(n,{variant:"outline",size:"sm",onClick:P,children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Export Excel"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(v,{className:"text-base",children:"Restore Data"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Upload a CSV or Excel file to restore your purchase records"})]}),e.jsxs("div",{children:[e.jsx("input",{ref:j,type:"file",accept:".csv,.xlsx",onChange:R,className:"hidden",id:"csv-upload"}),e.jsx(n,{variant:"outline",size:"sm",onClick:()=>{var a;return(a=j.current)==null?void 0:a.click()},disabled:C,children:C?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"h-4 w-4 mr-2 animate-spin"}),"Importing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Import"]})})]})]}),e.jsxs(n,{variant:"destructive",size:"sm",onClick:Y,children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Clear All Data"]})]})}),e.jsx(M,{children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:["You have ",Q(s==null?void 0:s.countTransactions,"record","records")," stored."]})})]})]})]})}export{pe as default};
