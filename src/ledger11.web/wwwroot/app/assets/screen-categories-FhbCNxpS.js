import{_ as N,r as g,j as e,S as T,ar as I,z as A,B as h,a3 as M,D as p,a as f,b as v,d as D,f as y,U as b,as as z,at as J,e as U,t as F,au as _,av as G,N as L,ah as V,Z as H}from"./index-BbVTBCs9.js";import{P as B,a as w,b as S,S as W,c as Y,d as Z,e as q,f as K,C as Q,g as X}from"./select-Bl3MXxy3.js";function $({value:c,onChange:u,title:t="Choose an icon"}){const m=N(),[l,n]=g.useState(!1),o=M(c),r=e.jsx(T,{className:"h-full",children:e.jsx("div",{className:"grid grid-cols-5 gap-2",children:Object.entries(I).map(([i,C])=>e.jsx("button",{type:"button",onClick:()=>{u(i),n(!1)},className:A("flex items-center justify-center w-10 h-10 rounded hover:bg-accent",i===c&&"bg-primary text-white"),children:e.jsx(C,{className:"w-5 h-5"})},i))})});return m?e.jsxs(e.Fragment,{children:[e.jsx(h,{variant:"ghost",className:"w-14 h-10 p-0",onClick:()=>n(!0),children:e.jsx(o,{className:"w-6 h-6"})}),e.jsx(p,{open:l,onOpenChange:n,children:e.jsxs(f,{className:"p-0",children:[e.jsx(v,{children:e.jsx(D,{className:"p-4 pb-2 text-base font-medium",children:t})}),e.jsx("div",{className:"h-full p-2 pt-0",children:r})]})})]}):e.jsxs(B,{open:l,onOpenChange:n,children:[e.jsx(w,{asChild:!0,children:e.jsx(h,{variant:"ghost",className:"w-14 h-10 p-0",children:e.jsx(o,{className:"w-6 h-6"})})}),e.jsx(S,{className:"w-64 h-64 p-2",children:r})]})}const ee=["#FF6B6B","#FCA311","#FFD93D","#6BCB77","#4D96FF","#9D4EDD","#FF5C8A","#00B8A9","#FF8C42","#F3722C","#90BE6D","#43AA8B","#577590","#118AB2","#8338EC","#FF006E","#E29578","#FFB627","#A1C181","#1D3557","#2EC4B6","#FF9F1C","#6A0572","#F72585","#06D6A0","#FFD166","#EF476F","#D90368","#7209B7","#3A86FF","#FF70A6","#70D6FF","#A9DEF9","#FDFFB6","#CAFFBF","#BDB2FF","#FFC6FF","#FFADAD","#FFB5A7","#B5E48C","#99D98C","#52B788","#34A0A4","#168AAD","#52796F","#FF9770","#FBC4AB","#CDB4DB","#D0F4DE","#FFDDD2","#FFCAD4","#FF7B9C","#D4A5A5","#A3C9A8","#F2C6B4","#7BDFF2","#B2F7EF","#EFF7F6","#FFE156","#6A4C93","#1982C4","#8AC926","#FF595E","#FFCA3A"];function se({value:c,onChange:u,title:t="Pick a color"}){const m=N(),[l,n]=g.useState(!1),o=e.jsx("div",{className:"grid grid-cols-8 gap-4",children:ee.map(r=>e.jsx("button",{type:"button",onClick:()=>{u(r),n(!1)},className:A("w-6 h-6 rounded-sm border border-muted shadow",r===c?"ring-2 ring-ring ring-offset-1":""),style:{backgroundColor:r}},r))});return m?e.jsxs(e.Fragment,{children:[e.jsx(h,{variant:"ghost",className:"w-10 h-10 p-0 border",onClick:()=>n(!0),style:{backgroundColor:c}}),e.jsx(p,{open:l,onOpenChange:n,children:e.jsxs(f,{className:"p-4",children:[e.jsx(v,{children:e.jsx(D,{className:"text-base font-medium mb-2",children:t})}),o]})})]}):e.jsxs(B,{open:l,onOpenChange:n,children:[e.jsx(w,{asChild:!0,children:e.jsx(h,{variant:"ghost",className:"w-10 h-10 p-0 border",style:{backgroundColor:c}})}),e.jsx(S,{className:"p-2",children:o})]})}function ae({category:c}){const{updateCategory:u}=y(),[t,m]=g.useState(c),[l,n]=g.useState(null),o=(r,i)=>{m(C=>({...C,[r]:i}))};return g.useEffect(()=>{l&&clearTimeout(l);const r=setTimeout(()=>{JSON.stringify(t)!==JSON.stringify(c)&&u(t.id,{name:t.name,color:t.color,icon:t.icon})},500);return n(r),()=>clearTimeout(r)},[t]),e.jsxs("div",{className:"flex gap-2 items-center w-full",children:[e.jsx(b,{className:"flex-grow",value:t.name,onChange:r=>o("name",r.target.value)}),e.jsx(se,{value:t.color||"#000000",onChange:r=>o("color",r),title:"Choose a color"}),e.jsx($,{value:t.icon||"",onChange:r=>o("icon",r),title:"Pick an icon"})]})}function re({category:c,trigger:u,onConfirm:t}){const{categories:m}=y(),[l,n]=g.useState(!1),[o,r]=g.useState(null),i=m.filter(x=>x.id!==c.id),C=()=>{if(o===null){F.error("Please select a replacement category");return}t(o),n(!1)};return e.jsxs(p,{open:l,onOpenChange:n,children:[e.jsx(z,{asChild:!0,children:u}),e.jsxs(f,{children:[e.jsxs(v,{children:[e.jsx(D,{children:"Replace & Delete Category"}),e.jsxs(J,{children:["Youâ€™re about to delete ",e.jsx("strong",{children:c.name}),". Select a category to reassign existing transactions."]})]}),e.jsx("div",{className:"space-y-2",children:e.jsxs(W,{onValueChange:x=>r(Number(x)),children:[e.jsx(Y,{children:e.jsx(Z,{placeholder:"Select replacement category"})}),e.jsx(q,{className:"max-h-[40vh] overflow-y-auto",children:i.map(x=>e.jsx(K,{className:"py-2 px-4",value:String(x.id),children:x.name},x.id))})]})}),e.jsxs(U,{children:[e.jsx(h,{variant:"outline",onClick:()=>n(!1),children:"Cancel"}),e.jsx(h,{onClick:C,disabled:o===null,children:"Confirm"})]})]})]})}function oe(){const{categories:c,addCategory:u,removeCategory:t,loadCategories:m}=y(),[l,n]=g.useState([]),[o,r]=g.useState(""),[i,C]=g.useState(!1);g.useEffect(()=>{m().then(s=>n(s.map((d,a)=>a)))},[m]);const x=async()=>{if(o.trim())try{await u({name:o,displsyOrder:0}),F.success("Category added"),r("")}catch(s){F.error("Failed to add category"),console.error(s)}},E=async(s,d)=>{try{const a=await t(s,d);n(a.map((j,P)=>P)),F.success("Category removed")}catch(a){F.error("Remove failed"),console.error(a)}},O=async()=>{if(i){try{await H("/api/category/reorder",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l.map(s=>c[s].id))}),F.success("Reorder saved")}catch(s){F.error("Reorder failed"),console.error(s)}C(!1)}else C(!0)},k=s=>{s<=0||n(d=>{const a=[...d];return[a[s-1],a[s]]=[a[s],a[s-1]],a})},R=s=>{s>=l.length-1||n(d=>{const a=[...d];return[a[s+1],a[s]]=[a[s],a[s+1]],a})};return e.jsxs("div",{className:"p-2 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[i&&e.jsx("div",{className:"flex-grow"}),!i&&e.jsxs(e.Fragment,{children:[e.jsx(b,{placeholder:"New category name",value:o,onChange:s=>r(s.target.value)}),e.jsx(h,{onClick:x,children:"Add"})]}),e.jsx(h,{variant:"secondary",onClick:O,children:i?"Done":"Reorder"})]}),e.jsx("div",{className:"space-y-4",children:e.jsx(_,{children:l.map((s,d)=>{const a=c[s];return a?e.jsxs(G.div,{layout:!0,transition:{type:"spring",stiffness:500,damping:30},children:[i&&e.jsxs("div",{className:"flex flex-row gap-4 items-center",children:[e.jsx(h,{size:"icon",onClick:()=>k(d),disabled:d===0,children:e.jsx(Q,{})}),e.jsx(h,{size:"icon",onClick:()=>R(d),disabled:d===l.length-1,children:e.jsx(X,{})}),e.jsx(L,{variant:"secondary",children:d+1}),e.jsx("div",{children:a.name})]}),!i&&e.jsxs("div",{className:"flex flex-row gap-4 items-center",children:[e.jsx(ae,{category:a}),e.jsx(re,{category:a,trigger:e.jsx(h,{variant:"outline",children:e.jsx(V,{})}),onConfirm:j=>{j&&E(a.id,j)}})]})]},a.id):null})})})]})}export{oe as default};
