import{_ as B,r as p,j as e,D as w,a as S,b as I,d as E,f as F,u as b,Q as j,U as N,e as q,B as v,t as y,$ as m,a0 as T,a1 as k,a2 as A,W as z,a3 as L,a4 as P,N as Q,a5 as U,a6 as D}from"./index-BbVTBCs9.js";import{C as H,d as W}from"./card-DlI9su2u.js";import{S as V,c as M,d as O,e as R,f as $}from"./select-Bl3MXxy3.js";import{T as _}from"./textarea-Buu2Dh5y.js";function G({value:s,onValueChange:c,options:d,placeholder:x="Select an option",title:n="Select an option"}){var a;const t=B(),[i,o]=p.useState(!1);if(!t)return e.jsxs(V,{value:s,onValueChange:c,children:[e.jsx(M,{children:e.jsx(O,{placeholder:x})}),e.jsx(R,{children:d.map(l=>e.jsx($,{value:l.value,children:l.label},l.value))})]});const r=(a=d.find(l=>l.value===s))==null?void 0:a.label;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border rounded-md px-3 py-2 text-sm w-full cursor-pointer",onClick:()=>o(!0),children:r||e.jsx("span",{className:"text-muted-foreground",children:x})}),e.jsx(w,{open:i,onOpenChange:o,children:e.jsxs(S,{className:"p-0",children:[e.jsx(I,{children:e.jsx(E,{className:"p-4 pb-2 text-base font-medium",children:n})}),e.jsx("div",{className:"divide-y max-h-[60vh] overflow-y-auto",children:d.map(l=>e.jsx("div",{className:"px-4 py-3 text-sm hover:bg-muted cursor-pointer",onClick:()=>{c(l.value),o(!1)},children:l.label},l.value))})]})})]})}function J({transaction:s,onClose:c}){var o;const{categories:d}=F(),{updateTransaction:x}=b(),[n,t]=p.useState({value:`${s.value}`,notes:s.notes?`${s.notes}`:"",categoryId:s.categoryId}),i=async()=>{x(s.id,{...s,value:n.value?Number.parseFloat(n.value):void 0,notes:n.notes,categoryId:n.categoryId||void 0}).then(()=>{y.success("Done!")}).catch(r=>{console.error("Error updating transaction:",r),y.error("Error updating transaction")}).finally(()=>{c()})};return e.jsx(w,{defaultOpen:!0,onOpenChange:c,children:e.jsxs(S,{children:[e.jsx(I,{children:e.jsx(E,{children:"Edit Transaction"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"edit-total",children:"Value"}),e.jsx(N,{id:"edit-total",type:"number",placeholder:"0.00",value:n.value,onChange:r=>{const a={...n,value:r.target.value};t(a)}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"edit-notes",children:"Notes"}),e.jsx(N,{id:"edit-notes",type:"text",placeholder:"Notes",value:n.notes,onChange:r=>{const a={...n,notes:r.target.value};t(a)}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"edit-category",children:"Category"}),e.jsx(G,{value:(o=n.categoryId)==null?void 0:o.toString(),onValueChange:r=>t({...n,categoryId:Number(r)}),options:d.map(r=>({value:r.id.toString(),label:r.name})),placeholder:"Select a category",title:"Choose Category"})]})]}),e.jsxs(q,{children:[e.jsx(v,{variant:"outline",onClick:c,children:"Cancel"}),e.jsx(v,{onClick:i,children:"Save Changes"})]})]})})}function K({transaction:s}){const{removeTransaction:c}=b(),[d,x]=p.useState(!1),n=()=>{requestAnimationFrame(()=>x(!0))},t=async()=>{await c(s.id),y.success("Deleted")};return e.jsxs(e.Fragment,{children:[e.jsxs(m,{children:[e.jsx(m.Trigger,{children:e.jsxs(v,{variant:"ghost",size:"icon",children:[e.jsx(T,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Actions"})]})}),e.jsxs(m.Content,{children:[e.jsxs(m.Item,{onClick:n,children:[e.jsx(k,{className:"h-4 w-4 mr-2"}),"Edit"]}),e.jsx(A,{title:"Delete item",description:"Are you sure you want to delete this item?",onConfirmed:t})]})]}),d&&e.jsx(J,{transaction:s,onClose:()=>x(!1)})]})}function X({transaction:s,detail:c,onClose:d}){var r;const{categories:x}=F(),{updateTransaction:n}=b(),[t,i]=p.useState({value:`${c.value}`,quantity:`${c.quantity}`,description:c.description||"",categoryId:c.categoryId}),o=async()=>{var l;const a={...s,transactionDetails:s.transactionDetails.map(h=>h.id===c.id?{...h,value:t.value?Number.parseFloat(t.value):void 0,quantity:t.quantity?Number.parseFloat(t.quantity):void 0,description:t.description||void 0,category:t.categoryId||void 0}:h)};a.value=(l=a.transactionDetails)==null?void 0:l.reduce((h,g)=>h+(g.value||0)*(g.quantity||1),0),await n(s.id,a),y.success("Done!"),d()};return e.jsx(w,{open:!0,onOpenChange:d,children:e.jsxs(S,{children:[e.jsx(I,{children:e.jsx(E,{children:"Edit Detail"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"edit-amount",children:"Value"}),e.jsx(N,{id:"edit-amount",type:"number",value:t.value,onChange:a=>{const l={...t,value:a.target.value};i(l)}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"edit-quantity",children:"Quantity"}),e.jsx(N,{id:"edit-quantity",type:"number",value:t.quantity,onChange:a=>{const l={...t,quantity:a.target.value};i(l)}})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"edit-description",children:"Description"}),e.jsx(_,{id:"edit-description",value:t.description,onChange:a=>i({...t,description:a.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"edit-category",children:"Category"}),e.jsxs(V,{value:(r=t.categoryId)==null?void 0:r.toString(),onValueChange:a=>i({...t,categoryId:Number(a)}),children:[e.jsx(M,{children:e.jsx(O,{placeholder:"Select a category"})}),e.jsx(R,{children:x.map(a=>e.jsx($,{value:a.id.toString(),children:a.name},a.id))})]})]})]}),e.jsxs(q,{children:[e.jsx(v,{variant:"outline",onClick:d,children:"Cancel"}),e.jsx(v,{onClick:o,children:"Save Changes"})]})]})})}function Y({transaction:s,detail:c}){const{updateTransaction:d}=b(),[x,n]=p.useState(!1),t=()=>{requestAnimationFrame(()=>{n(!0)})},i=async()=>{var o,r;s.transactionDetails=(o=s.transactionDetails)==null?void 0:o.filter(a=>a.id!==c.id),s.value=((r=s.transactionDetails)==null?void 0:r.reduce((a,l)=>a+(l.value||0)*(l.quantity||1),0))||0,await d(s.id,s),y.success("Done!")};return e.jsxs(e.Fragment,{children:[e.jsxs(m,{children:[e.jsx(m.Trigger,{children:e.jsxs(v,{variant:"ghost",size:"icon",onClick:o=>o.stopPropagation(),children:[e.jsx(T,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Actions"})]})}),e.jsxs(m.Content,{children:[e.jsxs(m.Item,{onClick:t,children:[e.jsx(k,{className:"h-4 w-4 mr-2"}),"Edit"]}),e.jsx(A,{title:"Delete item",description:"Are you sure you want to delete this item?",onConfirmed:i})]})]}),x&&e.jsx(X,{transaction:s,detail:c,onClose:()=>n(!1)})]})}function ae({transaction:s,expanded:c}){var h,g;const{categoryById:d}=F(),[x,n]=p.useState(c||!1),t=s.transactionDetails&&s.transactionDetails.length>0,i=d(s.categoryId),o=(i==null?void 0:i.name)||t&&((h=s.transactionDetails)==null?void 0:h.reduce((u,f)=>{const C=d(f.categoryId);return C&&!u.includes(C.name)&&u.push(C.name),u},[]).join(", ")),r=t?`(${z((g=s.transactionDetails)==null?void 0:g.length,"item","items")})`:"",a=s.notes||o||"No category",l=L(i==null?void 0:i.icon);return e.jsx(H,{className:"overflow-hidden border-t border-b border-l-0 border-r-0 rounded-none",children:e.jsxs(W,{className:"p-0",children:[e.jsxs("div",{className:"flex flex-row",children:[e.jsx("div",{className:"p-2 bg-muted flex items-center",style:i!=null&&i.color?{backgroundColor:i.color,color:P(i.color)}:{},children:(i==null?void 0:i.icon)&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx(l,{})})}),e.jsxs("div",{className:"pl-2 pt-1 pb-1 flex-grow flex items-start justify-between overflow-hidden",children:[e.jsx("div",{className:"flex items-start gap-2 cursor-pointer truncate",onClick:()=>t&&n(!x),children:e.jsx("div",{className:"flex flex-row gap-2 items-center",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"font-medium",children:a}),e.jsx(Q,{variant:"secondary",children:r})]}),e.jsxs("div",{className:"flex flex-wrap gap-x-2 text-sm text-muted-foreground overflow-hidden",children:[e.jsx("div",{className:"truncate overflow-hidden text-ellipsis whitespace-nowrap",children:s.user}),e.jsx("div",{className:"truncate overflow-hidden text-ellipsis whitespace-nowrap",children:U(s.date)})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:o})]})})}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"font-bold",children:s.value?D(s.value):"N/A"})}),e.jsx(K,{transaction:s})]})]})]}),t&&x&&e.jsx("div",{className:"border-t bg-muted/40",children:s.transactionDetails.map(u=>{var f;return e.jsx("div",{className:"pt-2 pb-2 pl-12 border-b last:border-b-0",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-grow",children:[e.jsx("div",{className:"font-medium",children:u.description||"Unnamed Item"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:((f=d(u.categoryId))==null?void 0:f.name)||"No category"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-bold",children:u.value?D((u.value||0)*(u.quantity||1)):"N/A"}),u.value&&u.quantity&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:[D(u.value)," Ã— ",u.quantity]})]}),e.jsx(Y,{transaction:s,detail:u})]})},u.id)})})]})})}export{ae as T};
