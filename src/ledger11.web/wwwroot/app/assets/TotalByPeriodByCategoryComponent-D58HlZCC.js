import{a3 as b,j as e,a6 as j,f as W,r as T,Z as Y,V as K}from"./index-BbVTBCs9.js";import{R as $,T as V,m as N,o as Z}from"./generateCategoricalChart-CuyCy8PD.js";import{P as z,a as C}from"./PieChart-BpkVxRR_.js";const F=({data:r,altData:i,title:x,categories:o,children:m})=>{const a=Object.entries(r).map(([t,l])=>{var d,h;return{name:t,value:l,color:((d=o[t])==null?void 0:d.color)||"#8884d8",icon:b((h=o[t])==null?void 0:h.icon)}}),c=i&&Object.entries(i).map(([t,l])=>{var d,h;return{name:t,value:l,color:((d=o[t])==null?void 0:d.color)||"#8884d8",icon:b((h=o[t])==null?void 0:h.icon)}}),u=a.reduce((t,l)=>t+l.value,0),n=c?c.reduce((t,l)=>t+l.value,0):0,{startAngle:s,endAngle:f,altStartAngle:E,altEndAngle:I}=U(u,n),R=n==0?60:70,g=60,k=20,y={today:"Today",yesterday:"Yesterday",thisWeek:"This Week",lastWeek:"Last Week",thisMonth:"This Month",lastMonth:"Last Month",thisYear:"This Year",lastYear:"Last Year",total:"All Time"},D=({viewBox:t})=>e.jsxs("text",{x:t.cx,y:t.cy,textAnchor:"middle",dominantBaseline:"middle",children:[e.jsx("tspan",{x:t.cx,y:(t.cy||0)-12,className:"fill-foreground text-3xl font-bold",children:j(u,0)}),e.jsxs("tspan",{x:t.cx,y:(t.cy||0)+12,className:"fill-muted-foreground text-l font-bold",children:["(",j(n,0),")"]}),e.jsx("tspan",{x:t.cx,y:(t.cy||0)+36,className:"fill-muted-foreground",children:y[x]})]}),M=({viewBox:t})=>e.jsxs("text",{x:t.cx,y:t.cy,textAnchor:"middle",dominantBaseline:"middle",children:[e.jsx("tspan",{x:t.cx,y:t.cy,className:"fill-foreground text-3xl font-bold",children:j(u,0)}),e.jsx("tspan",{x:t.cx,y:(t.cy||0)+24,className:"fill-muted-foreground",children:y[x]})]}),p=({cx:t,cy:l,midAngle:d,outerRadius:h,icon:L})=>{const A=Math.PI/180,O=t+(h+20)*Math.cos(-d*A),S=l+(h+20)*Math.sin(-d*A),P=L;return e.jsx(P,{x:O-10,y:S-10,width:"20",height:"20"})};return e.jsx("div",{children:a.length===0?e.jsx("p",{className:"text-muted-foreground text-center",children:"Â "}):e.jsxs("div",{className:"relative h-64 w-full flex flex-row ",children:[e.jsx($,{width:"100%",height:"100%",children:e.jsxs(z,{margin:{top:0,right:0,left:0,bottom:0},children:[e.jsx(V,{formatter:(t,l)=>[`${t}`,l]}),c&&e.jsx(C,{isAnimationActive:!1,label:p,data:c,dataKey:"value",nameKey:"name",startAngle:E,endAngle:I,outerRadius:g+k,innerRadius:g,paddingAngle:5,children:c.map((t,l)=>e.jsx(N,{fill:t.color},`cell-${l}`))}),e.jsxs(C,{isAnimationActive:!1,label:p,labelLine:!1,data:a,dataKey:"value",nameKey:"name",startAngle:s,endAngle:f,cx:"50%",cy:"50%",innerRadius:R,paddingAngle:5,fill:"#8884d8",children:[a.map((t,l)=>e.jsx(N,{fill:t.color},`cell-${l}`)),e.jsx(Z,{content:({viewBox:t})=>{if(t&&"cx"in t&&"cy"in t)return n===0?e.jsx(M,{viewBox:t}):e.jsx(D,{viewBox:t})}})]})]})}),m]})})};function U(r,i){const x=r+i,o=0,m=r/x*360,a=m+5,c=a+i/x*360-10;return{startAngle:o,endAngle:m,altStartAngle:a,altEndAngle:c}}function J(){const{categories:r,loadCategories:i}=W(),x=r.reduce((n,s)=>(n[s.name]=s,n),{}),[o,m]=T.useState(null);T.useEffect(()=>{r.length===0&&i().catch(s=>{console.error("Error loading categories:",s)});const n=Intl.DateTimeFormat().resolvedOptions().timeZone;Y(`/api/insight/${encodeURIComponent(n)}`).then(s=>{s.ok?s.json().then(f=>{m(f)}):console.error("Error fetching insights:",s.statusText)})},[r.length,i]);const{expense:a,income:c}=o??{},u=!a||Object.keys(a).reduce((n,s)=>n+Object.keys(a[s]).length,0)===0;return e.jsxs("div",{className:"relative",children:[u&&e.jsx("div",{className:"flex items-center justify-center pt-16",children:"No expenses."}),Object.entries(a||{}).map(([n,s])=>s&&e.jsx("div",{className:"mb-4",children:e.jsx(F,{data:s,altData:c==null?void 0:c[n],title:n,categories:x})},n)),o===null&&e.jsx("div",{className:"flex items-center justify-center pt-16",children:e.jsx(K,{size:220,thickness:32})})]})}export{J as default};
