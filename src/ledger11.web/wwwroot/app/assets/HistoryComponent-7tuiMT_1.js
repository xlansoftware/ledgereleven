import{r as x,j as e,z as f,ab as z,u as H,a2 as P}from"./index-B4qhsmr2.js";import{T as w,R as L,B as S,e as C}from"./generateCategoricalChart-D_v58Lm5.js";import{B as T,C as E,X as M,Y as O}from"./BarChart-Dm-pDHR_.js";const F={light:"",dark:".dark"},A=x.createContext(null);function B(){const s=x.useContext(A);if(!s)throw new Error("useChart must be used within a <ChartContainer />");return s}const _=x.forwardRef(({id:s,className:t,children:r,config:a,...c},h)=>{const d=x.useId(),l=`chart-${s||d.replace(/:/g,"")}`;return e.jsx(A.Provider,{value:{config:a},children:e.jsxs("div",{"data-chart":l,ref:h,className:f("flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none",t),...c,children:[e.jsx(U,{id:l,config:a}),e.jsx(L,{children:r})]})})});_.displayName="Chart";const U=({id:s,config:t})=>{const r=Object.entries(t).filter(([,a])=>a.theme||a.color);return r.length?e.jsx("style",{dangerouslySetInnerHTML:{__html:Object.entries(F).map(([a,c])=>`
${c} [data-chart=${s}] {
${r.map(([h,d])=>{var i;const l=((i=d.theme)==null?void 0:i[a])||d.color;return l?`  --color-${h}: ${l};`:null}).join(`
`)}
}
`).join(`
`)}}):null},W=w,D=x.forwardRef(({active:s,payload:t,className:r,indicator:a="dot",hideLabel:c=!1,hideIndicator:h=!1,label:d,labelFormatter:l,labelClassName:i,formatter:o,color:p,nameKey:R,labelKey:b},I)=>{const{config:m}=B(),$=x.useMemo(()=>{var j;if(c||!(t!=null&&t.length))return null;const[n]=t,k=`${b||(n==null?void 0:n.dataKey)||(n==null?void 0:n.name)||"value"}`,g=N(m,n,k),u=!b&&typeof d=="string"?((j=m[d])==null?void 0:j.label)||d:g==null?void 0:g.label;return l?e.jsx("div",{className:f("font-medium",i),children:l(u,t)}):u?e.jsx("div",{className:f("font-medium",i),children:u}):null},[d,l,t,c,i,m,b]);if(!s||!(t!=null&&t.length))return null;const v=t.length===1&&a!=="dot";return e.jsxs("div",{ref:I,className:f("grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl",r),children:[v?null:$,e.jsx("div",{className:"grid gap-1.5",children:t.map((n,k)=>{const g=`${R||n.name||n.dataKey||"value"}`,u=N(m,n,g),j=p||n.payload.fill||n.color;return e.jsx("div",{className:f("flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground",a==="dot"&&"items-center"),children:o&&(n==null?void 0:n.value)!==void 0&&n.name?o(n.value,n.name,n,k,n.payload):e.jsxs(e.Fragment,{children:[u!=null&&u.icon?e.jsx(u.icon,{}):!h&&e.jsx("div",{className:f("shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]",{"h-2.5 w-2.5":a==="dot","w-1":a==="line","w-0 border-[1.5px] border-dashed bg-transparent":a==="dashed","my-0.5":v&&a==="dashed"}),style:{"--color-bg":j,"--color-border":j}}),e.jsxs("div",{className:f("flex flex-1 justify-between leading-none",v?"items-end":"items-center"),children:[e.jsxs("div",{className:"grid gap-1.5",children:[v?$:null,e.jsx("span",{className:"text-muted-foreground",children:(u==null?void 0:u.label)||n.name})]}),n.value&&e.jsx("span",{className:"font-mono font-medium tabular-nums text-foreground",children:n.value.toLocaleString()})]})]})},n.dataKey)})})]})});D.displayName="ChartTooltip";const X=x.forwardRef(({className:s,hideIcon:t=!1,payload:r,verticalAlign:a="bottom",nameKey:c},h)=>{const{config:d}=B();return r!=null&&r.length?e.jsx("div",{ref:h,className:f("flex items-center justify-center gap-4",a==="top"?"pb-3":"pt-3",s),children:r.map(l=>{const i=`${c||l.dataKey||"value"}`,o=N(d,l,i);return e.jsxs("div",{className:f("flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground"),children:[o!=null&&o.icon&&!t?e.jsx(o.icon,{}):e.jsx("div",{className:"h-2 w-2 shrink-0 rounded-[2px]",style:{backgroundColor:l.color}}),o==null?void 0:o.label]},l.value)})}):null});X.displayName="ChartLegend";function N(s,t,r){if(typeof t!="object"||t===null)return;const a="payload"in t&&typeof t.payload=="object"&&t.payload!==null?t.payload:void 0;let c=r;return r in t&&typeof t[r]=="string"?c=t[r]:a&&r in a&&typeof a[r]=="string"&&(c=a[r]),c in s?s[c]:s[r]}function Y(s,t="en-US"){return new Date(s).toLocaleDateString(t,{weekday:"short"})}function Z({data:s}){return e.jsx(_,{config:{},children:e.jsx(L,{width:"100%",height:300,children:e.jsxs(T,{data:s,className:"pt-5",children:[e.jsx(w,{formatter:(t,r)=>[`${t}`,r]}),e.jsx(E,{vertical:!1}),e.jsx(M,{dataKey:"date",tickLine:!1,tickMargin:10,axisLine:!1,tickFormatter:t=>Y(t)}),e.jsx(S,{dataKey:"value",fill:"#8884d8",isAnimationActive:!1,radius:4,children:e.jsx(C,{position:"center",className:"fill-foreground",content:({value:t})=>z(Number(t),2)})})]})})})}const q={desktop:{label:"Desktop",color:"var(--chart-2)"},mobile:{label:"Mobile",color:"var(--chart-2)"},label:{color:"var(--background)"}};function K({data:s}){return e.jsx(_,{config:q,children:e.jsx(L,{width:"100%",height:300,children:e.jsxs(T,{accessibilityLayer:!0,data:s,layout:"vertical",margin:{right:16},children:[e.jsx(w,{formatter:(t,r)=>[`${t}`,r]}),e.jsx(E,{horizontal:!1}),e.jsx(O,{dataKey:"date",type:"category",tickLine:!1,tickMargin:10,axisLine:!1,hide:!0}),e.jsx(M,{dataKey:"value",type:"number",hide:!0}),e.jsx(W,{cursor:!1,content:e.jsx(D,{indicator:"line"})}),e.jsxs(S,{dataKey:"value",layout:"vertical",fill:"var(--color-desktop)",isAnimationActive:!1,radius:4,children:[e.jsx(C,{dataKey:"date",position:"insideLeft",offset:8,className:"fill-(--color-label)",fontSize:12}),e.jsx(C,{dataKey:"value",position:"right",offset:8,className:"fill-foreground",fontSize:12})]})]})})})}function y({title:s}){return e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white w-full text-center",children:s})}function Q(){const{categories:s}=H(),t=s.reduce((i,o)=>(i[o.name]=o,i),{}),[r,a]=x.useState(null);x.useEffect(()=>{const i=Intl.DateTimeFormat().resolvedOptions().timeZone;P(`/api/insight/history/${encodeURIComponent(i)}`).then(o=>{o.ok?o.json().then(p=>{a(p)}):console.error("Error fetching insights:",o.statusText)})},[s.length]);const{dayly:c,weekly:h,monthly:d}=r??{},l=i=>(i.forEach(o=>{o.value=Math.round(o.value)}),i);return e.jsxs("div",{className:"relative",children:[c&&e.jsxs("div",{className:"m-4",children:[e.jsx(y,{title:"Last 7 days"}),e.jsx(Z,{data:l(c.slice(-7)),title:"Daily",categories:t})]}),h&&e.jsxs("div",{className:"m-4",children:[e.jsx(y,{title:"Last 7 weeks"}),e.jsx(K,{data:l(h.slice(-7).reverse()),title:"Weekly",categories:t})]}),d&&e.jsxs("div",{className:"m-4",children:[e.jsx(y,{title:"Last 12 months"}),e.jsx(K,{data:l(d.slice(-12).reverse()),title:"Monthly",categories:t})]})]})}export{Q as default};
