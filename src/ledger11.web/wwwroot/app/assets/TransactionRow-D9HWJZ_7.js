import{a3 as z,r as p,j as e,R as T,T as q,U as V,V as k,W as $,D as I,a as S,b as E,d as F,u as y,Q as j,_ as b,e as R,B as v,t as f,a4 as m,a5 as A,a6 as M,a7 as O,a0 as L,a8 as P,a9 as Q,N as U,aa as _,ab as D}from"./index-CK-aAuUG.js";import{C as H,d as W}from"./card-C48GQk3C.js";import{T as G}from"./textarea-BaJAYStk.js";function J({value:s,onValueChange:n,options:i,placeholder:o="Select an option",title:r="Select an option"}){var t;const a=z(),[l,u]=p.useState(!1);if(!a)return e.jsxs(T,{value:s,onValueChange:n,children:[e.jsx(q,{children:e.jsx(V,{placeholder:o})}),e.jsx(k,{children:i.map(c=>e.jsx($,{value:c.value,children:c.label},c.value))})]});const d=(t=i.find(c=>c.value===s))==null?void 0:t.label;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border rounded-md px-3 py-2 text-sm w-full cursor-pointer",onClick:()=>u(!0),children:d||e.jsx("span",{className:"text-muted-foreground",children:o})}),e.jsx(I,{open:l,onOpenChange:u,children:e.jsxs(S,{className:"p-0",children:[e.jsx(E,{children:e.jsx(F,{className:"p-4 pb-2 text-base font-medium",children:r})}),e.jsx("div",{className:"divide-y max-h-[60vh] overflow-y-auto",children:i.map(c=>e.jsx("div",{className:"px-4 py-3 text-sm hover:bg-muted cursor-pointer",onClick:()=>{n(c.value),u(!1)},children:c.label},c.value))})]})})]})}function K({transaction:s,onClose:n}){var u;const{categories:i,updateTransaction:o}=y(),[r,a]=p.useState({value:`${s.value}`,notes:s.notes?`${s.notes}`:"",categoryId:s.categoryId}),l=async()=>{o(s.id,{...s,value:r.value?Number.parseFloat(r.value):void 0,notes:r.notes,categoryId:r.categoryId||void 0}).then(()=>{f.success("Done!")}).catch(d=>{console.error("Error updating transaction:",d),f.error("Error updating transaction")}).finally(()=>{n()})};return e.jsx(I,{defaultOpen:!0,onOpenChange:n,children:e.jsxs(S,{children:[e.jsx(E,{children:e.jsx(F,{children:"Edit Transaction"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"edit-total",children:"Value"}),e.jsx(b,{id:"edit-total",type:"number",placeholder:"0.00",value:r.value,onChange:d=>{const t={...r,value:d.target.value};a(t)}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"edit-notes",children:"Notes"}),e.jsx(b,{id:"edit-notes",type:"text",placeholder:"Notes",value:r.notes,onChange:d=>{const t={...r,notes:d.target.value};a(t)}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"edit-category",children:"Category"}),e.jsx(J,{value:(u=r.categoryId)==null?void 0:u.toString(),onValueChange:d=>a({...r,categoryId:Number(d)}),options:i.map(d=>({value:d.id.toString(),label:d.name})),placeholder:"Select a category",title:"Choose Category"})]})]}),e.jsxs(R,{children:[e.jsx(v,{variant:"outline",onClick:n,children:"Cancel"}),e.jsx(v,{onClick:l,children:"Save Changes"})]})]})})}function X({transaction:s}){const{removeTransaction:n}=y(),[i,o]=p.useState(!1),r=()=>{requestAnimationFrame(()=>o(!0))},a=async()=>{await n(s.id),f.success("Deleted")};return e.jsxs(e.Fragment,{children:[e.jsxs(m,{children:[e.jsx(m.Trigger,{children:e.jsxs(v,{variant:"ghost",size:"icon",children:[e.jsx(A,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Actions"})]})}),e.jsxs(m.Content,{children:[e.jsxs(m.Item,{onClick:r,children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Edit"]}),e.jsx(O,{title:"Delete item",description:"Are you sure you want to delete this item?",onConfirmed:a})]})]}),i&&e.jsx(K,{transaction:s,onClose:()=>o(!1)})]})}function Y({transaction:s,detail:n,onClose:i}){var d;const{categories:o,updateTransaction:r}=y(),[a,l]=p.useState({value:`${n.value}`,quantity:`${n.quantity}`,description:n.description||"",categoryId:n.categoryId}),u=async()=>{var c;const t={...s,transactionDetails:s.transactionDetails.map(h=>h.id===n.id?{...h,value:a.value?Number.parseFloat(a.value):void 0,quantity:a.quantity?Number.parseFloat(a.quantity):void 0,description:a.description||void 0,category:a.categoryId||void 0}:h)};t.value=(c=t.transactionDetails)==null?void 0:c.reduce((h,g)=>h+(g.value||0)*(g.quantity||1),0),await r(s.id,t),f.success("Done!"),i()};return e.jsx(I,{open:!0,onOpenChange:i,children:e.jsxs(S,{children:[e.jsx(E,{children:e.jsx(F,{children:"Edit Detail"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"edit-amount",children:"Value"}),e.jsx(b,{id:"edit-amount",type:"number",value:a.value,onChange:t=>{const c={...a,value:t.target.value};l(c)}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"edit-quantity",children:"Quantity"}),e.jsx(b,{id:"edit-quantity",type:"number",value:a.quantity,onChange:t=>{const c={...a,quantity:t.target.value};l(c)}})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"edit-description",children:"Description"}),e.jsx(G,{id:"edit-description",value:a.description,onChange:t=>l({...a,description:t.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"edit-category",children:"Category"}),e.jsxs(T,{value:(d=a.categoryId)==null?void 0:d.toString(),onValueChange:t=>l({...a,categoryId:Number(t)}),children:[e.jsx(q,{children:e.jsx(V,{placeholder:"Select a category"})}),e.jsx(k,{children:o.map(t=>e.jsx($,{value:t.id.toString(),children:t.name},t.id))})]})]})]}),e.jsxs(R,{children:[e.jsx(v,{variant:"outline",onClick:i,children:"Cancel"}),e.jsx(v,{onClick:u,children:"Save Changes"})]})]})})}function Z({transaction:s,detail:n}){const{updateTransaction:i}=y(),[o,r]=p.useState(!1),a=()=>{requestAnimationFrame(()=>{r(!0)})},l=async()=>{var u,d;s.transactionDetails=(u=s.transactionDetails)==null?void 0:u.filter(t=>t.id!==n.id),s.value=((d=s.transactionDetails)==null?void 0:d.reduce((t,c)=>t+(c.value||0)*(c.quantity||1),0))||0,await i(s.id,s),f.success("Done!")};return e.jsxs(e.Fragment,{children:[e.jsxs(m,{children:[e.jsx(m.Trigger,{children:e.jsxs(v,{variant:"ghost",size:"icon",onClick:u=>u.stopPropagation(),children:[e.jsx(A,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Actions"})]})}),e.jsxs(m.Content,{children:[e.jsxs(m.Item,{onClick:a,children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Edit"]}),e.jsx(O,{title:"Delete item",description:"Are you sure you want to delete this item?",onConfirmed:l})]})]}),o&&e.jsx(Y,{transaction:s,detail:n,onClose:()=>r(!1)})]})}function B(s,n,i){const o=s*(n??1);return D(o,2)}function w(s){return B(s.value||0,s.exchangeRate,s.currency)}function ee(s,n){if(!s.value)return"N/A";const i=s.value*(s.quantity||1);return B(i||0,n.exchangeRate,n.currency)}function se(s,n,i){return!i||!n?null:`${D(s,2)} x ${D(n,4)??1} ${i}`}function te(s){return se(s.value||0,s.exchangeRate,s.currency)}function ie({transaction:s,expanded:n}){var h,g;const{categoryById:i}=y(),[o,r]=p.useState(n||!1),a=s.transactionDetails&&s.transactionDetails.length>0,l=i(s.categoryId),u=(l==null?void 0:l.name)||a&&((h=s.transactionDetails)==null?void 0:h.reduce((x,N)=>{const C=i(N.categoryId);return C&&!x.includes(C.name)&&x.push(C.name),x},[]).join(", ")),d=a?`(${L((g=s.transactionDetails)==null?void 0:g.length,"item","items")})`:"",t=s.notes||u||"No category",c=P(l==null?void 0:l.icon);return e.jsx(H,{"data-testid":`Item: ${t}, ${w(s)}`,"aria-label":`Item: ${t}, ${w(s)}`,className:"overflow-hidden border-t border-b border-l-0 border-r-0 rounded-none",children:e.jsxs(W,{className:"p-0",children:[e.jsxs("div",{className:"flex flex-row",children:[e.jsx("div",{className:"p-2 bg-muted flex items-center",style:l!=null&&l.color?{backgroundColor:l.color,color:Q(l.color)}:{},children:(l==null?void 0:l.icon)&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx(c,{})})}),e.jsxs("div",{className:"pl-2 pt-1 pb-1 flex-grow flex items-start justify-between overflow-hidden",children:[e.jsx("div",{className:"flex items-start gap-2 cursor-pointer truncate",onClick:()=>a&&r(!o),children:e.jsx("div",{className:"flex flex-row gap-2 items-center",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"font-medium",children:t}),e.jsx(U,{variant:"secondary",children:d})]}),e.jsxs("div",{className:"flex flex-wrap gap-x-2 text-sm text-muted-foreground overflow-hidden",children:[e.jsx("div",{className:"truncate overflow-hidden text-ellipsis whitespace-nowrap",children:s.user}),e.jsx("div",{className:"truncate overflow-hidden text-ellipsis whitespace-nowrap",children:_(s.date)})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:u})]})})}),e.jsxs("div",{className:"flex flex-col flex-shrink-0 items-end",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"font-bold",children:w(s)})}),e.jsx(X,{transaction:s})]}),e.jsx("div",{className:"pr-2 text-sm text-muted-foreground",children:te(s)})]})]})]}),a&&o&&e.jsx("div",{className:"border-t bg-muted/40",children:s.transactionDetails.map(x=>{var N;return e.jsx("div",{className:"pt-2 pb-2 pl-12 border-b last:border-b-0",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-grow",children:[e.jsx("div",{className:"font-medium",children:x.description||"Unnamed Item"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:((N=i(x.categoryId))==null?void 0:N.name)||"No category"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-bold",children:ee(x,s)}),x.value&&x.quantity&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:[D(x.value)," Ã— ",x.quantity]})]}),e.jsx(Z,{transaction:s,detail:x})]})},x.id)})})]})})}export{ie as T};
