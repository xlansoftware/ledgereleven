import{Z as N,r as m,j as e,S as T,ao as P,y as A,B as h,a2 as I,D as j,a as f,b as D,d as v,u as y,T as B,ap as M,aq as J,e as z,t as C,ar as G,as as L,M as U,ag as V,Y}from"./index-BsiFfdWj.js";import{P as b,a as w,b as S,S as _,c as q,d as H,e as W,f as Z,C as K,g as Q}from"./select-1wvw_FRm.js";function X({value:t,onChange:u,title:o="Choose an icon"}){const d=N(),[l,n]=m.useState(!1),c=I(t),s=e.jsx(T,{className:"h-full",children:e.jsx("div",{className:"grid grid-cols-5 gap-2",children:Object.entries(P).map(([g,p])=>e.jsx("button",{type:"button",onClick:()=>{u(g),n(!1)},className:A("flex items-center justify-center w-10 h-10 rounded hover:bg-accent",g===t&&"bg-primary text-white"),children:e.jsx(p,{className:"w-5 h-5"})},g))})});return d?e.jsxs(e.Fragment,{children:[e.jsx(h,{variant:"ghost",className:"w-14 h-10 p-0",onClick:()=>n(!0),children:e.jsx(c,{className:"w-6 h-6"})}),e.jsx(j,{open:l,onOpenChange:n,children:e.jsxs(f,{className:"p-0",children:[e.jsx(D,{children:e.jsx(v,{className:"p-4 pb-2 text-base font-medium",children:o})}),e.jsx("div",{className:"h-full p-2 pt-0",children:s})]})})]}):e.jsxs(b,{open:l,onOpenChange:n,children:[e.jsx(w,{asChild:!0,children:e.jsx(h,{variant:"ghost",className:"w-14 h-10 p-0",children:e.jsx(c,{className:"w-6 h-6"})})}),e.jsx(S,{className:"w-64 h-64 p-2",children:s})]})}const $=["#FF6B6B","#FCA311","#FFD93D","#6BCB77","#4D96FF","#9D4EDD","#FF5C8A","#00B8A9","#FF8C42","#F3722C","#90BE6D","#43AA8B","#577590","#118AB2","#8338EC","#FF006E","#E29578","#FFB627","#A1C181","#1D3557","#2EC4B6","#FF9F1C","#6A0572","#F72585","#06D6A0","#FFD166","#EF476F","#D90368","#7209B7","#3A86FF","#FF70A6","#70D6FF","#A9DEF9","#FDFFB6","#CAFFBF","#BDB2FF","#FFC6FF","#FFADAD","#FFB5A7","#B5E48C","#99D98C","#52B788","#34A0A4","#168AAD","#52796F","#FF9770","#FBC4AB","#CDB4DB","#D0F4DE","#FFDDD2","#FFCAD4","#FF7B9C","#D4A5A5","#A3C9A8","#F2C6B4","#7BDFF2","#B2F7EF","#EFF7F6","#FFE156","#6A4C93","#1982C4","#8AC926","#FF595E","#FFCA3A"];function ee({value:t,onChange:u,title:o="Pick a color"}){const d=N(),[l,n]=m.useState(!1),c=e.jsx("div",{className:"grid grid-cols-8 gap-4",children:$.map(s=>e.jsx("button",{type:"button",onClick:()=>{u(s),n(!1)},className:A("w-6 h-6 rounded-sm border border-muted shadow",s===t?"ring-2 ring-ring ring-offset-1":""),style:{backgroundColor:s}},s))});return d?e.jsxs(e.Fragment,{children:[e.jsx(h,{variant:"ghost",className:"w-10 h-10 p-0 border",onClick:()=>n(!0),style:{backgroundColor:t}}),e.jsx(j,{open:l,onOpenChange:n,children:e.jsxs(f,{className:"p-4",children:[e.jsx(D,{children:e.jsx(v,{className:"text-base font-medium mb-2",children:o})}),c]})})]}):e.jsxs(b,{open:l,onOpenChange:n,children:[e.jsx(w,{asChild:!0,children:e.jsx(h,{variant:"ghost",className:"w-10 h-10 p-0 border",style:{backgroundColor:t}})}),e.jsx(S,{className:"p-2",children:c})]})}function se({category:t}){const{updateCategory:u}=y(),[o,d]=m.useState(t),[l,n]=m.useState(null),c=(s,g)=>{d(p=>({...p,[s]:g}))};return m.useEffect(()=>{l&&clearTimeout(l);const s=setTimeout(()=>{JSON.stringify(o)!==JSON.stringify(t)&&u(o.id,{name:o.name,color:o.color,icon:o.icon})},500);return n(s),()=>clearTimeout(s)},[o]),e.jsxs("div",{className:"flex gap-2 items-center w-full",children:[e.jsx(B,{className:"flex-grow",value:o.name,onChange:s=>c("name",s.target.value)}),e.jsx(ee,{value:o.color||"#000000",onChange:s=>c("color",s),title:"Choose a color"}),e.jsx(X,{value:o.icon||"",onChange:s=>c("icon",s),title:"Pick an icon"})]})}function ae({category:t,trigger:u,onConfirm:o}){const{categories:d}=y(),[l,n]=m.useState(!1),[c,s]=m.useState(null),g=d.filter(x=>x.id!==t.id),p=()=>{if(c===null){C.error("Please select a replacement category");return}o(c),n(!1)};return e.jsxs(j,{open:l,onOpenChange:n,children:[e.jsx(M,{asChild:!0,children:u}),e.jsxs(f,{children:[e.jsxs(D,{children:[e.jsx(v,{children:"Replace & Delete Category"}),e.jsxs(J,{children:["Youâ€™re about to delete ",e.jsx("strong",{children:t.name}),". Select a category to reassign existing transactions."]})]}),e.jsx("div",{className:"space-y-2",children:e.jsxs(_,{onValueChange:x=>s(Number(x)),children:[e.jsx(q,{children:e.jsx(H,{placeholder:"Select replacement category"})}),e.jsx(W,{className:"max-h-[40vh] overflow-y-auto",children:g.map(x=>e.jsx(Z,{className:"py-2 px-4",value:String(x.id),children:x.name},x.id))})]})}),e.jsxs(z,{children:[e.jsx(h,{variant:"outline",onClick:()=>n(!1),children:"Cancel"}),e.jsx(h,{onClick:p,disabled:c===null,children:"Confirm"})]})]})]})}function te(){const{categories:t,addCategory:u,removeCategory:o}=y(),[d,l]=m.useState([]),[n,c]=m.useState(""),[s,g]=m.useState(!1);m.useEffect(()=>{l(t.map((a,i)=>i))},[t]);const p=async()=>{if(n.trim())try{await u({name:n,displsyOrder:0}),C.success("Category added"),c("")}catch(a){C.error("Failed to add category"),console.error(a)}},x=async(a,i)=>{try{const r=await o(a,i);l(r.map((F,R)=>R)),C.success("Category removed")}catch(r){C.error("Remove failed"),console.error(r)}},E=async()=>{if(s){try{await Y("/api/category/reorder",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d.map(a=>t[a].id))}),C.success("Reorder saved")}catch(a){C.error("Reorder failed"),console.error(a)}g(!1)}else g(!0)},O=a=>{a<=0||l(i=>{const r=[...i];return[r[a-1],r[a]]=[r[a],r[a-1]],r})},k=a=>{a>=d.length-1||l(i=>{const r=[...i];return[r[a+1],r[a]]=[r[a],r[a+1]],r})};return e.jsxs("div",{className:"p-2 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s&&e.jsx("div",{className:"flex-grow"}),!s&&e.jsxs(e.Fragment,{children:[e.jsx(B,{placeholder:"New category name",value:n,onChange:a=>c(a.target.value)}),e.jsx(h,{onClick:p,children:"Add"})]}),e.jsx(h,{variant:"secondary",onClick:E,children:s?"Done":"Reorder"})]}),e.jsx("div",{className:"space-y-4",children:e.jsx(G,{children:d.map((a,i)=>{const r=t[a];return r?e.jsxs(L.div,{layout:!0,transition:{type:"spring",stiffness:500,damping:30},children:[s&&e.jsxs("div",{className:"flex flex-row gap-4 items-center",children:[e.jsx(h,{size:"icon",onClick:()=>O(i),disabled:i===0,children:e.jsx(K,{})}),e.jsx(h,{size:"icon",onClick:()=>k(i),disabled:i===d.length-1,children:e.jsx(Q,{})}),e.jsx(U,{variant:"secondary",children:i+1}),e.jsx("div",{children:r.name})]}),!s&&e.jsxs("div",{className:"flex flex-row gap-4 items-center",children:[e.jsx(se,{category:r}),e.jsx(ae,{category:r,trigger:e.jsx(h,{variant:"outline",children:e.jsx(V,{})}),onConfirm:F=>{F&&x(r.id,F)}})]})]},r.id):null})})})]})}export{te as default};
